"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.GlobalEmitter = void 0;
var _fusionCore = require("fusion-core");
var _emitter = _interopRequireDefault(require("./emitter"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
/** Copyright (c) 2018 Uber Technologies, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

/* eslint-env node */

class GlobalEmitter extends _emitter.default {
  constructor() {
    super();
    this.from = (0, _fusionCore.memoize)(ctx => {
      return new ScopedEmitter(ctx, this);
    });
  }
  emit(type, payload, ctx) {
    payload = super.mapEvent(type, payload, this.ctx);
    super.handleEvent(type, payload, ctx);
  }
  // mirror browser api
  setFrequency() {}
  teardown() {}
}
exports.GlobalEmitter = GlobalEmitter;
class ScopedEmitter extends _emitter.default {
  constructor(ctx, parent) {
    super();
    this.ctx = ctx;
    this.parent = parent;
    this.batch = [];
    this.flushed = false;
  }
  emit(type, payload) {
    // this logic exists to manage ensuring we send events after the batch
    if (this.flushed) {
      this.handleBatchedEvent({
        type,
        payload
      });
    } else {
      this.batch.push({
        type,
        payload
      });
    }
  }
  handleBatchedEvent({
    type,
    payload
  }) {
    payload = super.mapEvent(type, payload, this.ctx);
    payload = this.parent.mapEvent(type, payload, this.ctx);
    super.handleEvent(type, payload, this.ctx);
    this.parent.handleEvent(type, payload, this.ctx);
  }
  flush() {
    for (let index = 0; index < this.batch.length; index++) {
      this.handleBatchedEvent(this.batch[index]);
    }
    this.batch = [];
    this.flushed = true;
  }
  // mirror browser api
  setFrequency() {}
  teardown() {}
}
const plugin = true && (0, _fusionCore.createPlugin)({
  deps: {
    RouteTags: _fusionCore.RouteTagsToken
  },
  provides: () => new GlobalEmitter(),
  middleware: (deps, globalEmitter) => {
    const bodyParser = require('koa-bodyparser');
    // Forcing to parse JSON even if the Content-Type is different because we only expect JSON
    // payloads for events and the browser sends beacons with Content-Type: 'text/plain' due to
    // this bug http://crbug.com/490015
    const parseBody = bodyParser({
      detectJSON: () => true
    });
    return async function universalEventsMiddleware(ctx, next) {
      const emitter = globalEmitter.from(ctx);
      if (ctx.method === 'POST' && ctx.path === '/_events') {
        deps.RouteTags.from(ctx).name = 'universal_events';
        await parseBody(ctx, async () => {});
        // @ts-expect-error
        const {
          items
        } = ctx.request.body;
        if (items) {
          for (let index = 0; index < items.length; index++) {
            const {
              type,
              payload
            } = items[index];
            emitter.emit(type, payload);
          }
          ctx.status = 200;
        } else {
          ctx.status = 400;
        }
      }
      // awaiting next before registering `then` on ctx.timing.end to try and get as much as possible
      // into the event batch flush.
      try {
        await next();
      } finally {
        // handle flushing in the case of an error
        ctx.timing.end.then(() => {
          emitter.flush();
        });
      }
    };
  }
});
var _default = plugin;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJHbG9iYWxFbWl0dGVyIiwiRW1pdHRlciIsImNvbnN0cnVjdG9yIiwiZnJvbSIsIm1lbW9pemUiLCJjdHgiLCJTY29wZWRFbWl0dGVyIiwiZW1pdCIsInR5cGUiLCJwYXlsb2FkIiwibWFwRXZlbnQiLCJoYW5kbGVFdmVudCIsInNldEZyZXF1ZW5jeSIsInRlYXJkb3duIiwicGFyZW50IiwiYmF0Y2giLCJmbHVzaGVkIiwiaGFuZGxlQmF0Y2hlZEV2ZW50IiwicHVzaCIsImZsdXNoIiwiaW5kZXgiLCJsZW5ndGgiLCJwbHVnaW4iLCJjcmVhdGVQbHVnaW4iLCJkZXBzIiwiUm91dGVUYWdzIiwiUm91dGVUYWdzVG9rZW4iLCJwcm92aWRlcyIsIm1pZGRsZXdhcmUiLCJnbG9iYWxFbWl0dGVyIiwiYm9keVBhcnNlciIsInJlcXVpcmUiLCJwYXJzZUJvZHkiLCJkZXRlY3RKU09OIiwidW5pdmVyc2FsRXZlbnRzTWlkZGxld2FyZSIsIm5leHQiLCJlbWl0dGVyIiwibWV0aG9kIiwicGF0aCIsIm5hbWUiLCJpdGVtcyIsInJlcXVlc3QiLCJib2R5Iiwic3RhdHVzIiwidGltaW5nIiwiZW5kIiwidGhlbiJdLCJzb3VyY2VzIjpbInNyYy9zZXJ2ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqIENvcHlyaWdodCAoYykgMjAxOCBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqL1xuXG4vKiBlc2xpbnQtZW52IG5vZGUgKi9cbmltcG9ydCB7bWVtb2l6ZSwgY3JlYXRlUGx1Z2luLCBSb3V0ZVRhZ3NUb2tlbn0gZnJvbSAnZnVzaW9uLWNvcmUnO1xuaW1wb3J0IHR5cGUge0Z1c2lvblBsdWdpbiwgQ29udGV4dH0gZnJvbSAnZnVzaW9uLWNvcmUnO1xuXG5pbXBvcnQgRW1pdHRlciBmcm9tICcuL2VtaXR0ZXInO1xuaW1wb3J0IHR5cGUge1xuICBJRW1pdHRlcixcbiAgVW5pdmVyc2FsRXZlbnRzUGx1Z2luRGVwc1R5cGUgYXMgRGVwc1R5cGUsXG59IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgY2xhc3MgR2xvYmFsRW1pdHRlciBleHRlbmRzIEVtaXR0ZXIge1xuICBmcm9tOiAoY3R4OiBDb250ZXh0KSA9PiBTY29wZWRFbWl0dGVyO1xuICBjdHg6IENvbnRleHQ7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmZyb20gPSBtZW1vaXplKChjdHgpID0+IHtcbiAgICAgIHJldHVybiBuZXcgU2NvcGVkRW1pdHRlcihjdHgsIHRoaXMpO1xuICAgIH0pO1xuICB9XG4gIGVtaXQodHlwZTogc3RyaW5nLCBwYXlsb2FkOiB1bmtub3duLCBjdHg/OiBDb250ZXh0KTogdm9pZCB7XG4gICAgcGF5bG9hZCA9IHN1cGVyLm1hcEV2ZW50KHR5cGUsIHBheWxvYWQsIHRoaXMuY3R4KTtcbiAgICBzdXBlci5oYW5kbGVFdmVudCh0eXBlLCBwYXlsb2FkLCBjdHgpO1xuICB9XG4gIC8vIG1pcnJvciBicm93c2VyIGFwaVxuICBzZXRGcmVxdWVuY3koKSB7fVxuICB0ZWFyZG93bigpIHt9XG59XG5cbmNsYXNzIFNjb3BlZEVtaXR0ZXIgZXh0ZW5kcyBFbWl0dGVyIHtcbiAgY3R4OiBDb250ZXh0O1xuICBwYXJlbnQ6IEdsb2JhbEVtaXR0ZXI7XG4gIGJhdGNoOiBBcnJheTx7XG4gICAgdHlwZTogc3RyaW5nO1xuICAgIHBheWxvYWQ6IGFueTtcbiAgfT47XG4gIGZsdXNoZWQ6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3IoY3R4OiBDb250ZXh0LCBwYXJlbnQ6IEdsb2JhbEVtaXR0ZXIpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuY3R4ID0gY3R4O1xuICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICAgIHRoaXMuYmF0Y2ggPSBbXTtcbiAgICB0aGlzLmZsdXNoZWQgPSBmYWxzZTtcbiAgfVxuICBlbWl0KHR5cGU6IHN0cmluZywgcGF5bG9hZDogdW5rbm93bikge1xuICAgIC8vIHRoaXMgbG9naWMgZXhpc3RzIHRvIG1hbmFnZSBlbnN1cmluZyB3ZSBzZW5kIGV2ZW50cyBhZnRlciB0aGUgYmF0Y2hcbiAgICBpZiAodGhpcy5mbHVzaGVkKSB7XG4gICAgICB0aGlzLmhhbmRsZUJhdGNoZWRFdmVudCh7dHlwZSwgcGF5bG9hZH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmJhdGNoLnB1c2goe3R5cGUsIHBheWxvYWR9KTtcbiAgICB9XG4gIH1cbiAgaGFuZGxlQmF0Y2hlZEV2ZW50KHt0eXBlLCBwYXlsb2FkfToge3R5cGU6IHN0cmluZzsgcGF5bG9hZDogdW5rbm93bn0pIHtcbiAgICBwYXlsb2FkID0gc3VwZXIubWFwRXZlbnQodHlwZSwgcGF5bG9hZCwgdGhpcy5jdHgpO1xuICAgIHBheWxvYWQgPSB0aGlzLnBhcmVudC5tYXBFdmVudCh0eXBlLCBwYXlsb2FkLCB0aGlzLmN0eCk7XG4gICAgc3VwZXIuaGFuZGxlRXZlbnQodHlwZSwgcGF5bG9hZCwgdGhpcy5jdHgpO1xuICAgIHRoaXMucGFyZW50LmhhbmRsZUV2ZW50KHR5cGUsIHBheWxvYWQsIHRoaXMuY3R4KTtcbiAgfVxuICBmbHVzaCgpIHtcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5iYXRjaC5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIHRoaXMuaGFuZGxlQmF0Y2hlZEV2ZW50KHRoaXMuYmF0Y2hbaW5kZXhdKTtcbiAgICB9XG4gICAgdGhpcy5iYXRjaCA9IFtdO1xuICAgIHRoaXMuZmx1c2hlZCA9IHRydWU7XG4gIH1cbiAgLy8gbWlycm9yIGJyb3dzZXIgYXBpXG4gIHNldEZyZXF1ZW5jeSgpIHt9XG4gIHRlYXJkb3duKCkge31cbn1cblxuY29uc3QgcGx1Z2luID1cbiAgX19OT0RFX18gJiZcbiAgY3JlYXRlUGx1Z2luKHtcbiAgICBkZXBzOiB7XG4gICAgICBSb3V0ZVRhZ3M6IFJvdXRlVGFnc1Rva2VuLFxuICAgIH0sXG4gICAgcHJvdmlkZXM6ICgpID0+IG5ldyBHbG9iYWxFbWl0dGVyKCksXG4gICAgbWlkZGxld2FyZTogKGRlcHMsIGdsb2JhbEVtaXR0ZXIpID0+IHtcbiAgICAgIGNvbnN0IGJvZHlQYXJzZXIgPSByZXF1aXJlKCdrb2EtYm9keXBhcnNlcicpO1xuICAgICAgLy8gRm9yY2luZyB0byBwYXJzZSBKU09OIGV2ZW4gaWYgdGhlIENvbnRlbnQtVHlwZSBpcyBkaWZmZXJlbnQgYmVjYXVzZSB3ZSBvbmx5IGV4cGVjdCBKU09OXG4gICAgICAvLyBwYXlsb2FkcyBmb3IgZXZlbnRzIGFuZCB0aGUgYnJvd3NlciBzZW5kcyBiZWFjb25zIHdpdGggQ29udGVudC1UeXBlOiAndGV4dC9wbGFpbicgZHVlIHRvXG4gICAgICAvLyB0aGlzIGJ1ZyBodHRwOi8vY3JidWcuY29tLzQ5MDAxNVxuICAgICAgY29uc3QgcGFyc2VCb2R5ID0gYm9keVBhcnNlcih7ZGV0ZWN0SlNPTjogKCkgPT4gdHJ1ZX0pO1xuICAgICAgcmV0dXJuIGFzeW5jIGZ1bmN0aW9uIHVuaXZlcnNhbEV2ZW50c01pZGRsZXdhcmUoY3R4LCBuZXh0KSB7XG4gICAgICAgIGNvbnN0IGVtaXR0ZXIgPSBnbG9iYWxFbWl0dGVyLmZyb20oY3R4KTtcbiAgICAgICAgaWYgKGN0eC5tZXRob2QgPT09ICdQT1NUJyAmJiBjdHgucGF0aCA9PT0gJy9fZXZlbnRzJykge1xuICAgICAgICAgIGRlcHMuUm91dGVUYWdzLmZyb20oY3R4KS5uYW1lID0gJ3VuaXZlcnNhbF9ldmVudHMnO1xuICAgICAgICAgIGF3YWl0IHBhcnNlQm9keShjdHgsIGFzeW5jICgpID0+IHt9KTtcbiAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gICAgICAgICAgY29uc3Qge2l0ZW1zfSA9IGN0eC5yZXF1ZXN0LmJvZHk7XG4gICAgICAgICAgaWYgKGl0ZW1zKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgaXRlbXMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHt0eXBlLCBwYXlsb2FkfSA9IGl0ZW1zW2luZGV4XTtcbiAgICAgICAgICAgICAgZW1pdHRlci5lbWl0KHR5cGUsIHBheWxvYWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY3R4LnN0YXR1cyA9IDIwMDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY3R4LnN0YXR1cyA9IDQwMDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gYXdhaXRpbmcgbmV4dCBiZWZvcmUgcmVnaXN0ZXJpbmcgYHRoZW5gIG9uIGN0eC50aW1pbmcuZW5kIHRvIHRyeSBhbmQgZ2V0IGFzIG11Y2ggYXMgcG9zc2libGVcbiAgICAgICAgLy8gaW50byB0aGUgZXZlbnQgYmF0Y2ggZmx1c2guXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgbmV4dCgpO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgIC8vIGhhbmRsZSBmbHVzaGluZyBpbiB0aGUgY2FzZSBvZiBhbiBlcnJvclxuICAgICAgICAgIGN0eC50aW1pbmcuZW5kLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgZW1pdHRlci5mbHVzaCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0sXG4gIH0pO1xuXG5leHBvcnQgZGVmYXVsdCBwbHVnaW4gYXMgYW55IGFzIEZ1c2lvblBsdWdpbjxEZXBzVHlwZSwgSUVtaXR0ZXI+O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFRQTtBQUdBO0FBQWdDO0FBWGhDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFVTyxNQUFNQSxhQUFhLFNBQVNDLGdCQUFPLENBQUM7RUFJekNDLFdBQVcsR0FBRztJQUNaLEtBQUssRUFBRTtJQUNQLElBQUksQ0FBQ0Ms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