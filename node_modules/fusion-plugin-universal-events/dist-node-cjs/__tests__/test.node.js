"use strict";

var _fusionCore = _interopRequireWildcard(require("fusion-core"));
var _fusionTestUtils = require("fusion-test-utils");
var _server = _interopRequireWildcard(require("../server"));
var _index = require("../index");
function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }
function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }
/** Copyright (c) 2018 Uber Technologies, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

test('Instantiation', () => {
  const a = {
    memoized: new Map()
  };
  const b = {
    memoized: new Map()
  };
  const Emitter = new _server.GlobalEmitter();
  // @ts-expect-error
  expect(Emitter.from(a)).not.toBe(Emitter.from(b));
  // @ts-expect-error
  expect(Emitter.from(a)).not.toBe(Emitter);
});
test('Server EventEmitter - events from browser', async () => {
  let called = false;
  let globalCalled = false;
  const mockCtx = {
    headers: {},
    method: 'POST',
    path: '/_events',
    request: {
      body: {
        items: [{
          type: 'a',
          payload: {
            x: 1
          }
        }]
      }
    },
    timing: {
      end: Promise.resolve(5)
    }
  };
  const app = new _fusionCore.default('el', el => el);
  app.register(_index.UniversalEventsToken, _server.default);
  app.middleware({
    events: _index.UniversalEventsToken
  }, ({
    events
  }) => {
    events.on('a', ({
      x
    }, ctx) => {
      expect(x).toBe(1);
      expect(ctx).toBeTruthy();
      globalCalled = true;
    });
    return (ctx, next) => {
      const ctxEmitter = events.from(ctx);
      ctxEmitter.on('a', ({
        x
      }, ctx) => {
        expect(x).toBe(1);
        expect(ctx).toBeTruthy();
        called = true;
      });
      return next();
    };
  });
  app.resolve();
  await expect(
  // @ts-expect-error
  (0, _fusionCore.compose)(app.plugins)(mockCtx, () => Promise.resolve())).resolves.not.toThrow();
  expect(called).toBeTruthy();
  expect(globalCalled).toBeTruthy();
});
test('Server EventEmitter - events with ctx', done => {
  let globalCalled = false;
  const mockCtx = {
    mock: true
  };
  const app = new _fusionCore.default('el', el => el);
  app.register(_index.UniversalEventsToken, _server.default);
  app.register((0, _fusionCore.createPlugin)({
    deps: {
      events: _index.UniversalEventsToken
    },
    provides: ({
      events
    }) => {
      events.on('b', ({
        x
      }, ctx) => {
        expect(x).toBe(1);
        expect(ctx).toBe(mockCtx);
        globalCalled = true;
      });
      // @ts-expect-error
      events.emit('b', {
        x: 1
      }, mockCtx);
      expect(globalCalled).toBeTruthy();
      done();
    }
  }));
  app.resolve();
});
test('Server EventEmitter - mapping', async () => {
  let called = false;
  let globalCalled = false;
  const mockCtx = {
    headers: {},
    method: 'POST',
    path: '/lol',
    timing: {
      end: Promise.resolve(5)
    }
  };
  const app = new _fusionCore.default('fake-element', el => el);
  app.register(_index.UniversalEventsToken, _server.default);
  app.middleware({
    events: _index.UniversalEventsToken
  }, ({
    events
  }) => {
    events.on('a', (payload, c) => {
      expect(c).toBe(mockCtx);
      expect(payload).toStrictEqual({
        x: 1,
        b: true,
        global: true
      });
      globalCalled = true;
    });
    events.map('a', (payload, c) => {
      expect(c).toBe(mockCtx);
      return {
        ...payload,
        global: true
      };
    });
    return (ctx, next) => {
      const emitter = events.from(ctx);
      emitter.on('a', (payload, c) => {
        expect(c).toBe(ctx);
        expect(payload).toStrictEqual({
          x: 1,
          b: true,
          global: true
        });
        called = true;
      });
      emitter.map('a', (payload, c) => {
        expect(c).toBe(ctx);
        return {
          ...payload,
          b: true
        };
      });
      emitter.emit('a', {
        x: 1
      });
      return next();
    };
  });
  app.resolve();
  await expect(
  // @ts-expect-error
  (0, _fusionCore.compose)(app.plugins)(mockCtx, () => Promise.resolve())).resolves.not.toThrow();
  expect(called).toBeTruthy();
  expect(globalCalled).toBeTruthy();
});
test('Server EventEmitter error handling', done => {
  expect.assertions(1);
  const app = new _fusionCore.default('fake-element', el => el);
  app.register(_index.UniversalEventsToken, _server.default);
  app.middleware({
    events: _index.UniversalEventsToken
  }, ({
    events
  }) => {
    return async (ctx, next) => {
      const emitter = events.from(ctx);
      emitter.on('test-pre-await', ({
        x
      }) => {
        expect(x).toBe(1);
      });
      emitter.emit('test-pre-await', {
        x: 1
      });
      ctx.throw(403, 'error');
      return next();
    };
  });
  app.middleware((ctx, next) => {
    // $FlowFixMe
    done.fail('should not reach this middleware');
    return next();
  });
  const simulator = (0, _fusionTestUtils.getSimulator)(app);
  simulator.request('/lol', {
    method: 'POST'
  }).then(() => {
    // $FlowFixMe
    done.fail('should throw');
  }).catch(() => {
    done();
  });
});
test('Server EventEmitter batching', done => {
  const app = new _fusionCore.default('fake-element', el => el);
  const flags = {
    preawait: false,
    postawait: false,
    postend: false,
    timeout: false
  };
  app.register(_index.UniversalEventsToken, _server.default);
  app.middleware({
    events: _index.UniversalEventsToken
  }, ({
    events
  }) => {
    return async (ctx, next) => {
      const emitter = events.from(ctx);
      emitter.on('test-pre-await', ({
        x
      }) => {
        expect(x).toBe(1);
        flags.preawait = true;
      });
      emitter.emit('test-pre-await', {
        x: 1
      });
      expect(flags.preawait).toBeFalsy();
      // @ts-expect-error
      expect(emitter.flushed).toBeFalsy();
      return next();
    };
  });
  app.middleware({
    events: _index.UniversalEventsToken
  }, ({
    events
  }) => {
    return async (ctx, next) => {
      const emitter = events.from(ctx);
      emitter.on('test-post-await', ({
        x,
        lol
      }) => {
        expect(x).toBe(1);
        expect(lol).toBeTruthy();
        flags.postawait = true;
      });
      await next();
      emitter.emit('test-post-await', {
        x: 1
      });
      emitter.map(payload => {
        return {
          ...payload,
          lol: true
        };
      });
      // @ts-expect-error
      expect(emitter.flushed).toBeFalsy();
      expect(flags.postawait).toBeFalsy();
    };
  });
  app.middleware({
    events: _index.UniversalEventsToken
  }, ({
    events
  }) => {
    return async (ctx, next) => {
      const emitter = events.from(ctx);
      emitter.on('test-post-end', ({
        x,
        lol
      }) => {
        expect(x).toBe(1);
        expect(lol).toBeTruthy();
        flags.postend = true;
      });
      ctx.timing.end.then(() => {
        // @ts-expect-error
        expect(emitter.flushed).toBeFalsy();
        emitter.emit('test-post-end', {
          x: 1
        });
        expect(flags.postend).toBeFalsy();
      });
      return next();
    };
  });
  app.middleware({
    events: _index.UniversalEventsToken
  }, ({
    events
  }) => {
    return async (ctx, next) => {
      const emitter = events.from(ctx);
      emitter.on('test-timeout', ({
        x,
        lol
      }) => {
        expect(x).toBe(1);
        expect(lol).toBeTruthy();
        flags.timeout = true;
      });
      setTimeout(() => {
        // @ts-expect-error
        expect(emitter.flushed).toBeTruthy();
        emitter.emit('test-timeout', {
          x: 1
        });
        expect(flags.timeout).toBeTruthy();
      }, 100);
      return next();
    };
  });
  const simulator = (0, _fusionTestUtils.getSimulator)(app);
  simulator.request('/lol', {
    method: 'POST'
  });
  setTimeout(() => {
    expect(flags.preawait).toBeTruthy();
    expect(flags.postawait).toBeTruthy();
    expect(flags.postend).toBeTruthy();
    expect(flags.timeout).toBeTruthy();
    done();
  }, 150);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ0ZXN0IiwiYSIsIm1lbW9pemVkIiwiTWFwIiwiYiIsIkVtaXR0ZXIiLCJHbG9iYWxFbWl0dGVyIiwiZXhwZWN0IiwiZnJvbSIsIm5vdCIsInRvQmUiLCJjYWxsZWQiLCJnbG9iYWxDYWxsZWQiLCJtb2NrQ3R4IiwiaGVhZGVycyIsIm1ldGhvZCIsInBhdGgiLCJyZXF1ZXN0IiwiYm9keSIsIml0ZW1zIiwidHlwZSIsInBheWxvYWQiLCJ4IiwidGltaW5nIiwiZW5kIiwiUHJvbWlzZSIsInJlc29sdmUiLCJhcHAiLCJBcHAiLCJlbCIsInJlZ2lzdGVyIiwiVW5pdmVyc2FsRXZlbnRzVG9rZW4iLCJVbml2ZXJzYWxFdmVudHNQbHVnaW4iLCJtaWRkbGV3YXJlIiwiZXZlbnRzIiwib24iLCJjdHgiLCJ0b0JlVHJ1dGh5IiwibmV4dCIsImN0eEVtaXR0ZXIiLCJjb21wb3NlIiwicGx1Z2lucyIsInJlc29sdmVzIiwidG9UaHJvdyIsImRvbmUiLCJtb2NrIiwiY3JlYXRlUGx1Z2luIiwiZGVwcyIsInByb3ZpZGVzIiwiZW1pdCIsImMiLCJ0b1N0cmljdEVxdWFsIiwiZ2xvYmFsIiwibWFwIiwiZW1pdHRlciIsImFzc2VydGlvbnMiLCJ0aHJvdyIsImZhaWwiLCJzaW11bGF0b3IiLCJnZXRTaW11bGF0b3IiLCJ0aGVuIiwiY2F0Y2giLCJmbGFncyIsInByZWF3YWl0IiwicG9zdGF3YWl0IiwicG9zdGVuZCIsInRpbWVvdXQiLCJ0b0JlRmFsc3kiLCJmbHVzaGVkIiwibG9sIiwic2V0VGltZW91dCJdLCJzb3VyY2VzIjpbInNyYy9fX3Rlc3RzX18vdGVzdC5ub2RlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKiBDb3B5cmlnaHQgKGMpIDIwMTggVWJlciBUZWNobm9sb2dpZXMsIEluYy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKi9cblxuaW1wb3J0IEFwcCwge2NyZWF0ZVBsdWdpbiwgY29tcG9zZX0gZnJvbSAnZnVzaW9uLWNvcmUnO1xuaW1wb3J0IHtnZXRTaW11bGF0b3J9IGZyb20gJ2Z1c2lvbi10ZXN0LXV0aWxzJztcblxuaW1wb3J0IFVuaXZlcnNhbEV2ZW50c1BsdWdpbiwge0dsb2JhbEVtaXR0ZXJ9IGZyb20gJy4uL3NlcnZlcic7XG5pbXBvcnQge1VuaXZlcnNhbEV2ZW50c1Rva2VufSBmcm9tICcuLi9pbmRleCc7XG5pbXBvcnQgdHlwZSB7SUVtaXR0ZXJ9IGZyb20gJy4uL3R5cGVzJztcblxudGVzdCgnSW5zdGFudGlhdGlvbicsICgpID0+IHtcbiAgY29uc3QgYSA9IHtcbiAgICBtZW1vaXplZDogbmV3IE1hcCgpLFxuICB9O1xuICBjb25zdCBiID0ge1xuICAgIG1lbW9pemVkOiBuZXcgTWFwKCksXG4gIH07XG4gIGNvbnN0IEVtaXR0ZXI6IElFbWl0dGVyID0gbmV3IEdsb2JhbEVtaXR0ZXIoKTtcbiAgLy8gQHRzLWV4cGVjdC1lcnJvclxuICBleHBlY3QoRW1pdHRlci5mcm9tKGEpKS5ub3QudG9CZShFbWl0dGVyLmZyb20oYikpO1xuICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gIGV4cGVjdChFbWl0dGVyLmZyb20oYSkpLm5vdC50b0JlKEVtaXR0ZXIpO1xufSk7XG5cbnRlc3QoJ1NlcnZlciBFdmVudEVtaXR0ZXIgLSBldmVudHMgZnJvbSBicm93c2VyJywgYXN5bmMgKCkgPT4ge1xuICBsZXQgY2FsbGVkID0gZmFsc2U7XG4gIGxldCBnbG9iYWxDYWxsZWQgPSBmYWxzZTtcbiAgY29uc3QgbW9ja0N0eCA9IHtcbiAgICBoZWFkZXJzOiB7fSxcbiAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICBwYXRoOiAnL19ldmVudHMnLFxuICAgIHJlcXVlc3Q6IHtcbiAgICAgIGJvZHk6IHtcbiAgICAgICAgaXRlbXM6IFt7dHlwZTogJ2EnLCBwYXlsb2FkOiB7eDogMX19XSxcbiAgICAgIH0sXG4gICAgfSxcbiAgICB0aW1pbmc6IHtcbiAgICAgIGVuZDogUHJvbWlzZS5yZXNvbHZlKDUpLFxuICAgIH0sXG4gIH07XG4gIGNvbnN0IGFwcCA9IG5ldyBBcHAoJ2VsJywgKGVsKSA9PiBlbCk7XG4gIGFwcC5yZWdpc3RlcihVbml2ZXJzYWxFdmVudHNUb2tlbiwgVW5pdmVyc2FsRXZlbnRzUGx1Z2luKTtcbiAgYXBwLm1pZGRsZXdhcmUoe2V2ZW50czogVW5pdmVyc2FsRXZlbnRzVG9rZW59LCAoe2V2ZW50c30pID0+IHtcbiAgICBldmVudHMub24oJ2EnLCAoe3h9LCBjdHgpID0+IHtcbiAgICAgIGV4cGVjdCh4KS50b0JlKDEpO1xuICAgICAgZXhwZWN0KGN0eCkudG9CZVRydXRoeSgpO1xuICAgICAgZ2xvYmFsQ2FsbGVkID0gdHJ1ZTtcbiAgICB9KTtcbiAgICByZXR1cm4gKGN0eCwgbmV4dCkgPT4ge1xuICAgICAgY29uc3QgY3R4RW1pdHRlciA9IGV2ZW50cy5mcm9tKGN0eCk7XG4gICAgICBjdHhFbWl0dGVyLm9uKCdhJywgKHt4fSwgY3R4KSA9PiB7XG4gICAgICAgIGV4cGVjdCh4KS50b0JlKDEpO1xuICAgICAgICBleHBlY3QoY3R4KS50b0JlVHJ1dGh5KCk7XG4gICAgICAgIGNhbGxlZCA9IHRydWU7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBuZXh0KCk7XG4gICAgfTtcbiAgfSk7XG4gIGFwcC5yZXNvbHZlKCk7XG4gIGF3YWl0IGV4cGVjdChcbiAgICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gICAgY29tcG9zZShhcHAucGx1Z2lucykobW9ja0N0eCwgKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCkpXG4gICkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgZXhwZWN0KGNhbGxlZCkudG9CZVRydXRoeSgpO1xuICBleHBlY3QoZ2xvYmFsQ2FsbGVkKS50b0JlVHJ1dGh5KCk7XG59KTtcblxudGVzdCgnU2VydmVyIEV2ZW50RW1pdHRlciAtIGV2ZW50cyB3aXRoIGN0eCcsIChkb25lKSA9PiB7XG4gIGxldCBnbG9iYWxDYWxsZWQgPSBmYWxzZTtcbiAgY29uc3QgbW9ja0N0eCA9IHttb2NrOiB0cnVlfTtcbiAgY29uc3QgYXBwID0gbmV3IEFwcCgnZWwnLCAoZWwpID0+IGVsKTtcbiAgYXBwLnJlZ2lzdGVyKFVuaXZlcnNhbEV2ZW50c1Rva2VuLCBVbml2ZXJzYWxFdmVudHNQbHVnaW4pO1xuICBhcHAucmVnaXN0ZXIoXG4gICAgY3JlYXRlUGx1Z2luKHtcbiAgICAgIGRlcHM6IHtldmVudHM6IFVuaXZlcnNhbEV2ZW50c1Rva2VufSxcbiAgICAgIHByb3ZpZGVzOiAoe2V2ZW50c30pID0+IHtcbiAgICAgICAgZXZlbnRzLm9uKCdiJywgKHt4fSwgY3R4KSA9PiB7XG4gICAgICAgICAgZXhwZWN0KHgpLnRvQmUoMSk7XG4gICAgICAgICAgZXhwZWN0KGN0eCkudG9CZShtb2NrQ3R4KTtcbiAgICAgICAgICBnbG9iYWxDYWxsZWQgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvclxuICAgICAgICBldmVudHMuZW1pdCgnYicsIHt4OiAxfSwgbW9ja0N0eCk7XG4gICAgICAgIGV4cGVjdChnbG9iYWxDYWxsZWQpLnRvQmVUcnV0aHkoKTtcbiAgICAgICAgZG9uZSgpO1xuICAgICAgfSxcbiAgICB9KVxuICApO1xuICBhcHAucmVzb2x2ZSgpO1xufSk7XG5cbnRlc3QoJ1NlcnZlciBFdmVudEVtaXR0ZXIgLSBtYXBwaW5nJywgYXN5bmMgKCkgPT4ge1xuICBsZXQgY2FsbGVkID0gZmFsc2U7XG4gIGxldCBnbG9iYWxDYWxsZWQgPSBmYWxzZTtcbiAgY29uc3QgbW9ja0N0eCA9IHtcbiAgICBoZWFkZXJzOiB7fSxcbiAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICBwYXRoOiAnL2xvbCcsXG4gICAgdGltaW5nOiB7XG4gICAgICBlbmQ6IFByb21pc2UucmVzb2x2ZSg1KSxcbiAgICB9LFxuICB9O1xuICBjb25zdCBhcHAgPSBuZXcgQXBwKCdmYWtlLWVsZW1lbnQnLCAoZWwpID0+IGVsKTtcbiAgYXBwLnJlZ2lzdGVyKFVuaXZlcnNhbEV2ZW50c1Rva2VuLCBVbml2ZXJzYWxFdmVudHNQbHVnaW4pO1xuICBhcHAubWlkZGxld2FyZSh7ZXZlbnRzOiBVbml2ZXJzYWxFdmVudHNUb2tlbn0sICh7ZXZlbnRzfSkgPT4ge1xuICAgIGV2ZW50cy5vbignYScsIChwYXlsb2FkLCBjKSA9PiB7XG4gICAgICBleHBlY3QoYykudG9CZShtb2NrQ3R4KTtcbiAgICAgIGV4cGVjdChwYXlsb2FkKS50b1N0cmljdEVxdWFsKHt4OiAxLCBiOiB0cnVlLCBnbG9iYWw6IHRydWV9KTtcbiAgICAgIGdsb2JhbENhbGxlZCA9IHRydWU7XG4gICAgfSk7XG4gICAgZXZlbnRzLm1hcCgnYScsIChwYXlsb2FkLCBjKSA9PiB7XG4gICAgICBleHBlY3QoYykudG9CZShtb2NrQ3R4KTtcbiAgICAgIHJldHVybiB7Li4ucGF5bG9hZCwgZ2xvYmFsOiB0cnVlfTtcbiAgICB9KTtcbiAgICByZXR1cm4gKGN0eCwgbmV4dCkgPT4ge1xuICAgICAgY29uc3QgZW1pdHRlciA9IGV2ZW50cy5mcm9tKGN0eCk7XG4gICAgICBlbWl0dGVyLm9uKCdhJywgKHBheWxvYWQsIGMpID0+IHtcbiAgICAgICAgZXhwZWN0KGMpLnRvQmUoY3R4KTtcbiAgICAgICAgZXhwZWN0KHBheWxvYWQpLnRvU3RyaWN0RXF1YWwoe3g6IDEsIGI6IHRydWUsIGdsb2JhbDogdHJ1ZX0pO1xuICAgICAgICBjYWxsZWQgPSB0cnVlO1xuICAgICAgfSk7XG4gICAgICBlbWl0dGVyLm1hcCgnYScsIChwYXlsb2FkLCBjKSA9PiB7XG4gICAgICAgIGV4cGVjdChjKS50b0JlKGN0eCk7XG4gICAgICAgIHJldHVybiB7Li4ucGF5bG9hZCwgYjogdHJ1ZX07XG4gICAgICB9KTtcbiAgICAgIGVtaXR0ZXIuZW1pdCgnYScsIHt4OiAxfSk7XG4gICAgICByZXR1cm4gbmV4dCgpO1xuICAgIH07XG4gIH0pO1xuICBhcHAucmVzb2x2ZSgpO1xuICBhd2FpdCBleHBlY3QoXG4gICAgLy8gQHRzLWV4cGVjdC1lcnJvclxuICAgIGNvbXBvc2UoYXBwLnBsdWdpbnMpKG1vY2tDdHgsICgpID0+IFByb21pc2UucmVzb2x2ZSgpKVxuICApLnJlc29sdmVzLm5vdC50b1Rocm93KCk7XG4gIGV4cGVjdChjYWxsZWQpLnRvQmVUcnV0aHkoKTtcbiAgZXhwZWN0KGdsb2JhbENhbGxlZCkudG9CZVRydXRoeSgpO1xufSk7XG5cbnRlc3QoJ1NlcnZlciBFdmVudEVtaXR0ZXIgZXJyb3IgaGFuZGxpbmcnLCAoZG9uZSkgPT4ge1xuICBleHBlY3QuYXNzZXJ0aW9ucygxKTtcbiAgY29uc3QgYXBwID0gbmV3IEFwcCgnZmFrZS1lbGVtZW50JywgKGVsKSA9PiBlbCk7XG4gIGFwcC5yZWdpc3RlcihVbml2ZXJzYWxFdmVudHNUb2tlbiwgVW5pdmVyc2FsRXZlbnRzUGx1Z2luKTtcbiAgYXBwLm1pZGRsZXdhcmUoe2V2ZW50czogVW5pdmVyc2FsRXZlbnRzVG9rZW59LCAoe2V2ZW50c30pID0+IHtcbiAgICByZXR1cm4gYXN5bmMgKGN0eCwgbmV4dCkgPT4ge1xuICAgICAgY29uc3QgZW1pdHRlciA9IGV2ZW50cy5mcm9tKGN0eCk7XG4gICAgICBlbWl0dGVyLm9uKCd0ZXN0LXByZS1hd2FpdCcsICh7eH0pID0+IHtcbiAgICAgICAgZXhwZWN0KHgpLnRvQmUoMSk7XG4gICAgICB9KTtcbiAgICAgIGVtaXR0ZXIuZW1pdCgndGVzdC1wcmUtYXdhaXQnLCB7eDogMX0pO1xuICAgICAgY3R4LnRocm93KDQwMywgJ2Vycm9yJyk7XG4gICAgICByZXR1cm4gbmV4dCgpO1xuICAgIH07XG4gIH0pO1xuICBhcHAubWlkZGxld2FyZSgoY3R4LCBuZXh0KSA9PiB7XG4gICAgLy8gJEZsb3dGaXhNZVxuICAgIGRvbmUuZmFpbCgnc2hvdWxkIG5vdCByZWFjaCB0aGlzIG1pZGRsZXdhcmUnKTtcbiAgICByZXR1cm4gbmV4dCgpO1xuICB9KTtcbiAgY29uc3Qgc2ltdWxhdG9yID0gZ2V0U2ltdWxhdG9yKGFwcCk7XG4gIHNpbXVsYXRvclxuICAgIC5yZXF1ZXN0KCcvbG9sJywge21ldGhvZDogJ1BPU1QnfSlcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICAvLyAkRmxvd0ZpeE1lXG4gICAgICBkb25lLmZhaWwoJ3Nob3VsZCB0aHJvdycpO1xuICAgIH0pXG4gICAgLmNhdGNoKCgpID0+IHtcbiAgICAgIGRvbmUoKTtcbiAgICB9KTtcbn0pO1xuXG50ZXN0KCdTZXJ2ZXIgRXZlbnRFbWl0dGVyIGJhdGNoaW5nJywgKGRvbmUpID0+IHtcbiAgY29uc3QgYXBwID0gbmV3IEFwcCgnZmFrZS1lbGVtZW50JywgKGVsKSA9PiBlbCk7XG4gIGNvbnN0IGZsYWdzID0ge1xuICAgIHByZWF3YWl0OiBmYWxzZSxcbiAgICBwb3N0YXdhaXQ6IGZhbHNlLFxuICAgIHBvc3RlbmQ6IGZhbHNlLFxuICAgIHRpbWVvdXQ6IGZhbHNlLFxuICB9O1xuICBhcHAucmVnaXN0ZXIoVW5pdmVyc2FsRXZlbnRzVG9rZW4sIFVuaXZlcnNhbEV2ZW50c1BsdWdpbik7XG4gIGFwcC5taWRkbGV3YXJlKHtldmVudHM6IFVuaXZlcnNhbEV2ZW50c1Rva2VufSwgKHtldmVudHN9KSA9PiB7XG4gICAgcmV0dXJuIGFzeW5jIChjdHgsIG5leHQpID0+IHtcbiAgICAgIGNvbnN0IGVtaXR0ZXIgPSBldmVudHMuZnJvbShjdHgpO1xuICAgICAgZW1pdHRlci5vbigndGVzdC1wcmUtYXdhaXQnLCAoe3h9KSA9PiB7XG4gICAgICAgIGV4cGVjdCh4KS50b0JlKDEpO1xuICAgICAgICBmbGFncy5wcmVhd2FpdCA9IHRydWU7XG4gICAgICB9KTtcbiAgICAgIGVtaXR0ZXIuZW1pdCgndGVzdC1wcmUtYXdhaXQnLCB7eDogMX0pO1xuICAgICAgZXhwZWN0KGZsYWdzLnByZWF3YWl0KS50b0JlRmFsc3koKTtcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3JcbiAgICAgIGV4cGVjdChlbWl0dGVyLmZsdXNoZWQpLnRvQmVGYWxzeSgpO1xuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9O1xuICB9KTtcblxuICBhcHAubWlkZGxld2FyZSh7ZXZlbnRzOiBVbml2ZXJzYWxFdmVudHNUb2tlbn0sICh7ZXZlbnRzfSkgPT4ge1xuICAgIHJldHVybiBhc3luYyAoY3R4LCBuZXh0KSA9PiB7XG4gICAgICBjb25zdCBlbWl0dGVyID0gZXZlbnRzLmZyb20oY3R4KTtcbiAgICAgIGVtaXR0ZXIub24oJ3Rlc3QtcG9zdC1hd2FpdCcsICh7eCwgbG9sfSkgPT4ge1xuICAgICAgICBleHBlY3QoeCkudG9CZSgxKTtcbiAgICAgICAgZXhwZWN0KGxvbCkudG9CZVRydXRoeSgpO1xuICAgICAgICBmbGFncy5wb3N0YXdhaXQgPSB0cnVlO1xuICAgICAgfSk7XG4gICAgICBhd2FpdCBuZXh0KCk7XG4gICAgICBlbWl0dGVyLmVtaXQoJ3Rlc3QtcG9zdC1hd2FpdCcsIHt4OiAxfSk7XG4gICAgICBlbWl0dGVyLm1hcCgocGF5bG9hZCkgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLnBheWxvYWQsXG4gICAgICAgICAgbG9sOiB0cnVlLFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gICAgICBleHBlY3QoZW1pdHRlci5mbHVzaGVkKS50b0JlRmFsc3koKTtcbiAgICAgIGV4cGVjdChmbGFncy5wb3N0YXdhaXQpLnRvQmVGYWxzeSgpO1xuICAgIH07XG4gIH0pO1xuXG4gIGFwcC5taWRkbGV3YXJlKHtldmVudHM6IFVuaXZlcnNhbEV2ZW50c1Rva2VufSwgKHtldmVudHN9KSA9PiB7XG4gICAgcmV0dXJuIGFzeW5jIChjdHgsIG5leHQpID0+IHtcbiAgICAgIGNvbnN0IGVtaXR0ZXIgPSBldmVudHMuZnJvbShjdHgpO1xuICAgICAgZW1pdHRlci5vbigndGVzdC1wb3N0LWVuZCcsICh7eCwgbG9sfSkgPT4ge1xuICAgICAgICBleHBlY3QoeCkudG9CZSgxKTtcbiAgICAgICAgZXhwZWN0KGxvbCkudG9CZVRydXRoeSgpO1xuICAgICAgICBmbGFncy5wb3N0ZW5kID0gdHJ1ZTtcbiAgICAgIH0pO1xuICAgICAgY3R4LnRpbWluZy5lbmQudGhlbigoKSA9PiB7XG4gICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3JcbiAgICAgICAgZXhwZWN0KGVtaXR0ZXIuZmx1c2hlZCkudG9CZUZhbHN5KCk7XG4gICAgICAgIGVtaXR0ZXIuZW1pdCgndGVzdC1wb3N0LWVuZCcsIHt4OiAxfSk7XG4gICAgICAgIGV4cGVjdChmbGFncy5wb3N0ZW5kKS50b0JlRmFsc3koKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9O1xuICB9KTtcblxuICBhcHAubWlkZGxld2FyZSh7ZXZlbnRzOiBVbml2ZXJzYWxFdmVudHNUb2tlbn0sICh7ZXZlbnRzfSkgPT4ge1xuICAgIHJldHVybiBhc3luYyAoY3R4LCBuZXh0KSA9PiB7XG4gICAgICBjb25zdCBlbWl0dGVyID0gZXZlbnRzLmZyb20oY3R4KTtcbiAgICAgIGVtaXR0ZXIub24oJ3Rlc3QtdGltZW91dCcsICh7eCwgbG9sfSkgPT4ge1xuICAgICAgICBleHBlY3QoeCkudG9CZSgxKTtcbiAgICAgICAgZXhwZWN0KGxvbCkudG9CZVRydXRoeSgpO1xuICAgICAgICBmbGFncy50aW1lb3V0ID0gdHJ1ZTtcbiAgICAgIH0pO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3JcbiAgICAgICAgZXhwZWN0KGVtaXR0ZXIuZmx1c2hlZCkudG9CZVRydXRoeSgpO1xuICAgICAgICBlbWl0dGVyLmVtaXQoJ3Rlc3QtdGltZW91dCcsIHt4OiAxfSk7XG4gICAgICAgIGV4cGVjdChmbGFncy50aW1lb3V0KS50b0JlVHJ1dGh5KCk7XG4gICAgICB9LCAxMDApO1xuICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICB9O1xuICB9KTtcbiAgY29uc3Qgc2ltdWxhdG9yID0gZ2V0U2ltdWxhdG9yKGFwcCk7XG4gIHNpbXVsYXRvci5yZXF1ZXN0KCcvbG9sJywge21ldGhvZDogJ1BPU1QnfSk7XG5cbiAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgZXhwZWN0KGZsYWdzLnByZWF3YWl0KS50b0JlVHJ1dGh5KCk7XG4gICAgZXhwZWN0KGZsYWdzLnBvc3Rhd2FpdCkudG9CZVRydXRoeSgpO1xuICAgIGV4cGVjdChmbGFncy5wb3N0ZW5kKS50b0JlVHJ1dGh5KCk7XG4gICAgZXhwZWN0KGZsYWdzLnRpbWVvdXQpLnRvQmVUcnV0aHkoKTtcbiAgICBkb25lKCk7XG4gIH0sIDE1MCk7XG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7QUFPQTtBQUNBO0FBRUE7QUFDQTtBQUE4QztBQUFBO0FBWDlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFTQUEsSUFBSSxDQUFDLGVBQWUsRUFBRSxNQUFNO0VBQzFCLE1BQU1DLENBQUMsR0FBRztJQUNSQyxRQUFRLEVBQUUsSUFBSUMsR0FBRztFQUNuQixDQUFDO0VBQ0QsTUFBTUMsQ0FBQyxHQUFHO0lBQ1JGLFFBQVEsRUFBRSxJQUFJQyxHQUFHO0VBQ25CLENBQUM7RUFDRCxNQUFNRSxPQUFpQixHQUFHLElBQUlDLHFCQUFhLEVBQUU7RUFDN0M7RUFDQUMsTUFBTSxDQUFDRixPQUFPLENBQUNHLElBQUksQ0FBQ1AsQ0FBQyxDQUFDLENBQUMsQ0FBQ1EsR0FBRyxDQUFDQyxJQUFJLENBQUNMLE9BQU8sQ0FBQ0csSUFBSSxDQUFDSixDQUFDLENBQUMsQ0FBQztFQUNqRDtFQUNBRyxNQUFNLENBQUNGLE9BQU8sQ0FBQ0csSUFBSSxDQUFDUCxDQUFDLENBQUMsQ0FBQyxDQUFDUSxHQUFHLENBQUNDLElBQUksQ0FBQ0wsT0FBTyxDQUFDO0FBQzNDLENBQUMsQ0FBQztBQUVGTCxJQUFJLENBQUMsMkNBQTJDLEVBQUUsWUFBWTtFQUM1RCxJQUFJVyxNQUFNLEdBQUcsS0FBSztFQUNsQixJQUFJQyxZQUFZLEdBQUcsS0FBSztFQUN4QixNQUFNQyxPQUFPLEdBQUc7SUFDZEMsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUNYQyxNQUFNLEVBQUUsTUFBTTtJQUNkQyxJQUFJLEVBQUUsVUFBVTtJQUNoQkMsT0FBTyxFQUFFO01BQ1BDLElBQUksRUFBRTtRQUNKQyxLQUFLLEVBQUUsQ0FBQztVQUFDQyxJQUFJLEVBQUUsR0FBRztVQUFFQyxPQUFPLEVBQUU7WUFBQ0MsQ0FBQyxFQUFFO1VBQUM7UUFBQyxDQUFDO01BQ3RDO0lBQ0YsQ0FBQztJQUNEQyxNQUFNLEVBQUU7TUFDTkMsR0FBRyxFQUFFQyxPQUFPLENBQUNDLE9BQU8sQ0FBQyxDQUFDO0lBQ3hCO0VBQ0YsQ0FBQztFQUNELE1BQU1DLEdBQUcsR0FBRyxJQUFJQyxtQkFBRyxDQUFDLElBQUksRUFBR0MsRUFBRSxJQUFLQSxFQUFFLENBQUM7RUFDckNGLEdBQUcsQ0FBQ0csUUFBUSxDQUFDQywyQkFBb0IsRUFBRUMsZUFBcUIsQ0FBQztFQUN6REwsR0FBRyxDQUFDTSxVQUFVLENBQUM7SUFBQ0MsTUFBTSxFQUFFSDtFQUFvQixDQUFDLEVBQUUsQ0FBQztJQUFDRztFQUFNLENBQUMsS0FBSztJQUMzREEsTUFBTSxDQUFDQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUM7TUFBQ2I7SUFBQyxDQUFDLEVBQUVjLEdBQUcsS0FBSztNQUMzQjdCLE1BQU0sQ0FBQ2UsQ0FBQyxDQUFDLENBQUNaLElBQUksQ0FBQyxDQUFDLENBQUM7TUFDakJILE1BQU0sQ0FBQzZCLEdBQUcsQ0FBQyxDQUFDQyxVQUFVLEVBQUU7TUFDeEJ6QixZQUFZLEdBQUcsSUFBSTtJQUNyQixDQUFDLENBQUM7SUFDRixPQUFPLENBQUN3QixHQUFHLEVBQUVFLElBQUksS0FBSztNQUNwQixNQUFNQyxVQUFVLEdBQUdMLE1BQU0sQ0FBQzFCLElBQUksQ0FBQzRCLEdBQUcsQ0FBQztNQUNuQ0csVUFBVSxDQUFDSixFQUFFLENBQUMsR0FBRyxFQUFFLENBQUM7UUFBQ2I7TUFBQyxDQUFDLEVBQUVjLEdBQUcsS0FBSztRQUMvQjdCLE1BQU0sQ0FBQ2UsQ0FBQyxDQUFDLENBQUNaLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDakJILE1BQU0sQ0FBQzZCLEdBQUcsQ0FBQyxDQUFDQyxVQUFVLEVBQUU7UUFDeEIxQixNQUFNLEdBQUcsSUFBSTtNQUNmLENBQUMsQ0FBQztNQUNGLE9BQU8yQixJQUFJLEVBQUU7SUFDZixDQUFDO0VBQ0gsQ0FBQyxDQUFDO0VBQ0ZYLEdBQUcsQ0FBQ0QsT0FBTyxFQUFFO0VBQ2IsTUFBTW5CLE1BQU07RUFDVjtFQUNBLElBQUFpQyxtQkFBTyxFQUFDYixHQUFHLENBQUNjLE9BQU8sQ0FBQyxDQUFDNUIsT0FBTyxFQUFFLE1BQU1ZLE9BQU8sQ0FBQ0MsT0FBTyxFQUFFLENBQUMsQ0FDdkQsQ0FBQ2dCLFFBQVEsQ0FBQ2pDLEdBQUcsQ0FBQ2tDLE9BQU8sRUFBRTtFQUN4QnBDLE1BQU0sQ0FBQ0ksTUFBTSxDQUFDLENBQUMwQixVQUFVLEVBQUU7RUFDM0I5QixNQUFNLENBQUNLLFlBQVksQ0FBQyxDQUFDeUIsVUFBVSxFQUFFO0FBQ25DLENBQUMsQ0FBQztBQUVGckMsSUFBSSxDQUFDLHVDQUF1QyxFQUFHNEMsSUFBSSxJQUFLO0VBQ3RELElBQUloQyxZQUFZLEdBQUcsS0FBSztFQUN4QixNQUFNQyxPQUFPLEdBQUc7SUFBQ2dDLElBQUksRUFBRTtFQUFJLENBQUM7RUFDNUIsTUFBTWxCLEdBQUcsR0FBRyxJQUFJQyxtQkFBRyxDQUFDLElBQUksRUFBR0MsRUFBRSxJQUFLQSxFQUFFLENBQUM7RUFDckNGLEdBQUcsQ0FBQ0csUUFBUSxDQUFDQywyQkFBb0IsRUFBRUMsZUFBcUIsQ0FBQztFQUN6REwsR0FBRyxDQUFDRyxRQUFRLENBQ1YsSUFBQWdCLHdCQUFZLEVBQUM7SUFDWEMsSUFBSSxFQUFFO01BQUNiLE1BQU0sRUFBRUg7SUFBb0IsQ0FBQztJQUNwQ2lCLFFBQVEsRUFBRSxDQUFDO01BQUNkO0lBQU0sQ0FBQyxLQUFLO01BQ3RCQSxNQUFNLENBQUNDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUFDYjtNQUFDLENBQUMsRUFBRWMsR0FBRyxLQUFLO1FBQzNCN0IsTUFBTSxDQUFDZSxDQUFDLENBQUMsQ0FBQ1osSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNqQkgsTUFBTSxDQUFDNkIsR0FBRyxDQUFDLENBQUMxQixJQUFJLENBQUNHLE9BQU8sQ0FBQztRQUN6QkQsWUFBWSxHQUFHLElBQUk7TUFDckIsQ0FBQyxDQUFDO01BQ0Y7TUFDQXNCLE1BQU0sQ0FBQ2UsSUFBSSxDQUFDLEdBQUcsRUFBRTtRQUFDM0IsQ0FBQyxFQUFFO01BQUMsQ0FBQyxFQUFFVCxPQUFPLENBQUM7TUFDakNOLE1BQU0sQ0FBQ0ssWUFBWSxDQUFDLENBQUN5QixVQUFVLEVBQUU7TUFDakNPLElBQUksRUFBRTtJQUNSO0VBQ0YsQ0FBQyxDQUFDLENBQ0g7RUFDRGpCLEdBQUcsQ0FBQ0QsT0FBTyxFQUFFO0FBQ2YsQ0FBQyxDQUFDO0FBRUYxQixJQUFJLENBQUMsK0JBQStCLEVBQUUsWUFBWTtFQUNoRCxJQUFJVyxNQUFNLEdBQUcsS0FBSztFQUNsQixJQUFJQyxZQUFZLEdBQUcsS0FBSztFQUN4QixNQUFNQyxPQUFPLEdBQUc7SUFDZEMsT0FBTyxFQUFFLENBQUMsQ0FBQztJQUNYQyxNQUFNLEVBQUUsTUFBTTtJQUNkQyxJQUFJLEVBQUUsTUFBTTtJQUNaTyxNQUFNLEVBQUU7TUFDTkMsR0FBRyxFQUFFQyxPQUFPLENBQUNDLE9BQU8sQ0FBQyxDQUFDO0lBQ3hCO0VBQ0YsQ0FBQztFQUNELE1BQU1DLEdBQUcsR0FBRyxJQUFJQyxtQkFBRyxDQUFDLGNBQWMsRUFBR0MsRUFBRSxJQUFLQSxFQUFFLENBQUM7RUFDL0NGLEdBQUcsQ0FBQ0csUUFBUSxDQUFDQywyQkFBb0IsRUFBRUMsZUFBcUIsQ0FBQztFQUN6REwsR0FBRyxDQUFDTSxVQUFVLENBQUM7SUFBQ0MsTUFBTSxFQUFFSDtFQUFvQixDQUFDLEVBQUUsQ0FBQztJQUFDRztFQUFNLENBQUMsS0FBSztJQUMzREEsTUFBTSxDQUFDQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUNkLE9BQU8sRUFBRTZCLENBQUMsS0FBSztNQUM3QjNDLE1BQU0sQ0FBQzJDLENBQUMsQ0FBQyxDQUFDeEMsSUFBSSxDQUFDRyxPQUFPLENBQUM7TUFDdkJOLE1BQU0sQ0FBQ2MsT0FBTyxDQUFDLENBQUM4QixhQUFhLENBQUM7UUFBQzdCLENBQUMsRUFBRSxDQUFDO1FBQUVsQixDQUFDLEVBQUUsSUFBSTtRQUFFZ0QsTUFBTSxFQUFFO01BQUksQ0FBQyxDQUFDO01BQzVEeEMsWUFBWSxHQUFHLElBQUk7SUFDckIsQ0FBQyxDQUFDO0lBQ0ZzQixNQUFNLENBQUNtQixHQUFHLENBQUMsR0FBRyxFQUFFLENBQUNoQyxPQUFPLEVBQUU2QixDQUFDLEtBQUs7TUFDOUIzQyxNQUFNLENBQUMyQyxDQUFDLENBQUMsQ0FBQ3hDLElBQUksQ0FBQ0csT0FBTyxDQUFDO01BQ3ZCLE9BQU87UUFBQyxHQUFHUSxPQUFPO1FBQUUrQixNQUFNLEVBQUU7TUFBSSxDQUFDO0lBQ25DLENBQUMsQ0FBQztJQUNGLE9BQU8sQ0FBQ2hCLEdBQUcsRUFBRUUsSUFBSSxLQUFLO01BQ3BCLE1BQU1nQixPQUFPLEdBQUdwQixNQUFNLENBQUMxQixJQUFJLENBQUM0QixHQUFHLENBQUM7TUFDaENrQixPQUFPLENBQUNuQixFQUFFLENBQUMsR0FBRyxFQUFFLENBQUNkLE9BQU8sRUFBRTZCLENBQUMsS0FBSztRQUM5QjNDLE1BQU0sQ0FBQzJDLENBQUMsQ0FBQyxDQUFDeEMsSUFBSSxDQUFDMEIsR0FBRyxDQUFDO1FBQ25CN0IsTUFBTSxDQUFDYyxPQUFPLENBQUMsQ0FBQzhCLGFBQWEsQ0FBQztVQUFDN0IsQ0FBQyxFQUFFLENBQUM7VUFBRWxCLENBQUMsRUFBRSxJQUFJO1VBQUVnRCxNQUFNLEVBQUU7UUFBSSxDQUFDLENBQUM7UUFDNUR6QyxNQUFNLEdBQUcsSUFBSTtNQUNmLENBQUMsQ0FBQztNQUNGMkMsT0FBTyxDQUFDRCxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUNoQyxPQUFPLEVBQUU2QixDQUFDLEtBQUs7UUFDL0IzQyxNQUFNLENBQUMyQyxDQUFDLENBQUMsQ0FBQ3hDLElBQUksQ0FBQzBCLEdBQUcsQ0FBQztRQUNuQixPQUFPO1VBQUMsR0FBR2YsT0FBTztVQUFFakIsQ0FBQyxFQUFFO1FBQUksQ0FBQztNQUM5QixDQUFDLENBQUM7TUFDRmtELE9BQU8sQ0FBQ0wsSUFBSSxDQUFDLEdBQUcsRUFBRTtRQUFDM0IsQ0FBQyxFQUFFO01BQUMsQ0FBQyxDQUFDO01BQ3pCLE9BQU9nQixJQUFJLEVBQUU7SUFDZixDQUFDO0VBQ0gsQ0FBQyxDQUFDO0VBQ0ZYLEdBQUcsQ0FBQ0QsT0FBTyxFQUFFO0VBQ2IsTUFBTW5CLE1BQU07RUFDVjtFQUNBLElBQUFpQyxtQkFBTyxFQUFDYixHQUFHLENBQUNjLE9BQU8sQ0FBQyxDQUFDNUIsT0FBTyxFQUFFLE1BQU1ZLE9BQU8sQ0FBQ0MsT0FBTyxFQUFFLENBQUMsQ0FDdkQsQ0FBQ2dCLFFBQVEsQ0FBQ2pDLEdBQUcsQ0FBQ2tDLE9BQU8sRUFBRTtFQUN4QnBDLE1BQU0sQ0FBQ0ksTUFBTSxDQUFDLENBQUMwQixVQUFVLEVBQUU7RUFDM0I5QixNQUFNLENBQUNLLFlBQVksQ0FBQyxDQUFDeUIsVUFBVSxFQUFFO0FBQ25DLENBQUMsQ0FBQztBQUVGckMsSUFBSSxDQUFDLG9DQUFvQyxFQUFHNEMsSUFBSSxJQUFLO0VBQ25EckMsTUFBTSxDQUFDZ0QsVUFBVSxDQUFDLENBQUMsQ0FBQztFQUNwQixNQUFNNUIsR0FBRyxHQUFHLElBQUlDLG1CQUFHLENBQUMsY0FBYyxFQUFHQyxFQUFFLElBQUtBLEVBQUUsQ0FBQztFQUMvQ0YsR0FBRyxDQUFDRyxRQUFRLENBQUNDLDJCQUFvQixFQUFFQyxlQUFxQixDQUFDO0VBQ3pETCxHQUFHLENBQUNNLFVBQVUsQ0FBQztJQUFDQyxNQUFNLEVBQUVIO0VBQW9CLENBQUMsRUFBRSxDQUFDO0lBQUNHO0VBQU0sQ0FBQyxLQUFLO0lBQzNELE9BQU8sT0FBT0UsR0FBRyxFQUFFRSxJQUFJLEtBQUs7TUFDMUIsTUFBTWdCLE9BQU8sR0FBR3BCLE1BQU0sQ0FBQzFCLElBQUksQ0FBQzRCLEdBQUcsQ0FBQztNQUNoQ2tCLE9BQU8sQ0FBQ25CLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQUNiO01BQUMsQ0FBQyxLQUFLO1FBQ3BDZixNQUFNLENBQUNlLENBQUMsQ0FBQyxDQUFDWixJQUFJLENBQUMsQ0FBQyxDQUFDO01BQ25CLENBQUMsQ0FBQztNQUNGNEMsT0FBTyxDQUFDTCxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7UUFBQzNCLENBQUMsRUFBRTtNQUFDLENBQUMsQ0FBQztNQUN0Q2MsR0FBRyxDQUFDb0IsS0FBSyxDQUFDLEdBQUcsRUFBRSxPQUFPLENBQUM7TUFDdkIsT0FBT2xCLElBQUksRUFBRTtJQUNmLENBQUM7RUFDSCxDQUFDLENBQUM7RUFDRlgsR0FBRyxDQUFDTSxVQUFVLENBQUMsQ0FBQ0csR0FBRyxFQUFFRSxJQUFJLEtBQUs7SUFDNUI7SUFDQU0sSUFBSSxDQUFDYSxJQUFJLENBQUMsa0NBQWtDLENBQUM7SUFDN0MsT0FBT25CLElBQUksRUFBRTtFQUNmLENBQUMsQ0FBQztFQUNGLE1BQU1vQixTQUFTLEdBQUcsSUFBQUMsNkJBQVksRUFBQ2hDLEdBQUcsQ0FBQztFQUNuQytCLFNBQVMsQ0FDTnpDLE9BQU8sQ0FBQyxNQUFNLEVBQUU7SUFBQ0YsTUFBTSxFQUFFO0VBQU0sQ0FBQyxDQUFDLENBQ2pDNkMsSUFBSSxDQUFDLE1BQU07SUFDVjtJQUNBaEIsSUFBSSxDQUFDYSxJQUFJLENBQUMsY0FBYyxDQUFDO0VBQzNCLENBQUMsQ0FBQyxDQUNESSxLQUFLLENBQUMsTUFBTTtJQUNYakIsSUFBSSxFQUFFO0VBQ1IsQ0FBQyxDQUFDO0FBQ04sQ0FBQyxDQUFDO0FBRUY1QyxJQUFJLENBQUMsOEJBQThCLEVBQUc0QyxJQUFJLElBQUs7RUFDN0MsTUFBTWpCLEdBQUcsR0FBRyxJQUFJQyxtQkFBRyxDQUFDLGNBQWMsRUFBR0MsRUFBRSxJQUFLQSxFQUFFLENBQUM7RUFDL0MsTUFBTWlDLEtBQUssR0FBRztJQUNaQyxRQUFRLEVBQUUsS0FBSztJQUNmQyxTQUFTLEVBQUUsS0FBSztJQUNoQkMsT0FBTyxFQUFFLEtBQUs7SUFDZEMsT0FBTyxFQUFFO0VBQ1gsQ0FBQztFQUNEdkMsR0FBRyxDQUFDRyxRQUFRLENBQUNDLDJCQUFvQixFQUFFQyxlQUFxQixDQUFDO0VBQ3pETCxHQUFHLENBQUNNLFVBQVUsQ0FBQztJQUFDQyxNQUFNLEVBQUVIO0VBQW9CLENBQUMsRUFBRSxDQUFDO0lBQUNHO0VBQU0sQ0FBQyxLQUFLO0lBQzNELE9BQU8sT0FBT0UsR0FBRyxFQUFFRSxJQUFJLEtBQUs7TUFDMUIsTUFBTWdCLE9BQU8sR0FBR3BCLE1BQU0sQ0FBQzFCLElBQUksQ0FBQzRCLEdBQUcsQ0FBQztNQUNoQ2tCLE9BQU8sQ0FBQ25CLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQUNiO01BQUMsQ0FBQyxLQUFLO1FBQ3BDZixNQUFNLENBQUNlLENBQUMsQ0FBQyxDQUFDWixJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2pCb0QsS0FBSyxDQUFDQyxRQUFRLEdBQUcsSUFBSTtNQUN2QixDQUFDLENBQUM7TUFDRlQsT0FBTyxDQUFDTCxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7UUFBQzNCLENBQUMsRUFBRTtNQUFDLENBQUMsQ0FBQztNQUN0Q2YsTUFBTSxDQUFDdUQsS0FBSyxDQUFDQyxRQUFRLENBQUMsQ0FBQ0ksU0FBUyxFQUFFO01BQ2xDO01BQ0E1RCxNQUFNLENBQUMrQyxPQUFPLENBQUNjLE9BQU8sQ0FBQyxDQUFDRCxTQUFTLEVBQUU7TUFDbkMsT0FBTzdCLElBQUksRUFBRTtJQUNmLENBQUM7RUFDSCxDQUFDLENBQUM7RUFFRlgsR0FBRyxDQUFDTSxVQUFVLENBQUM7SUFBQ0MsTUFBTSxFQUFFSDtFQUFvQixDQUFDLEVBQUUsQ0FBQztJQUFDRztFQUFNLENBQUMsS0FBSztJQUMzRCxPQUFPLE9BQU9FLEdBQUcsRUFBRUUsSUFBSSxLQUFLO01BQzFCLE1BQU1nQixPQUFPLEdBQUdwQixNQUFNLENBQUMxQixJQUFJLENBQUM0QixHQUFHLENBQUM7TUFDaENrQixPQUFPLENBQUNuQixFQUFFLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUFDYixDQUFDO1FBQUUrQztNQUFHLENBQUMsS0FBSztRQUMxQzlELE1BQU0sQ0FBQ2UsQ0FBQyxDQUFDLENBQUNaLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDakJILE1BQU0sQ0FBQzhELEdBQUcsQ0FBQyxDQUFDaEMsVUFBVSxFQUFFO1FBQ3hCeUIsS0FBSyxDQUFDRSxTQUFTLEdBQUcsSUFBSTtNQUN4QixDQUFDLENBQUM7TUFDRixNQUFNMUIsSUFBSSxFQUFFO01BQ1pnQixPQUFPLENBQUNMLElBQUksQ0FBQyxpQkFBaUIsRUFBRTtRQUFDM0IsQ0FBQyxFQUFFO01BQUMsQ0FBQyxDQUFDO01BQ3ZDZ0MsT0FBTyxDQUFDRCxHQUFHLENBQUVoQyxPQUFPLElBQUs7UUFDdkIsT0FBTztVQUNMLEdBQUdBLE9BQU87VUFDVmdELEdBQUcsRUFBRTtRQUNQLENBQUM7TUFDSCxDQUFDLENBQUM7TUFDRjtNQUNBOUQsTUFBTSxDQUFDK0MsT0FBTyxDQUFDYyxPQUFPLENBQUMsQ0FBQ0QsU0FBUyxFQUFFO01BQ25DNUQsTUFBTSxDQUFDdUQsS0FBSyxDQUFDRSxTQUFTLENBQUMsQ0FBQ0csU0FBUyxFQUFFO0lBQ3JDLENBQUM7RUFDSCxDQUFDLENBQUM7RUFFRnhDLEdBQUcsQ0FBQ00sVUFBVSxDQUFDO0lBQUNDLE1BQU0sRUFBRUg7RUFBb0IsQ0FBQyxFQUFFLENBQUM7SUFBQ0c7RUFBTSxDQUFDLEtBQUs7SUFDM0QsT0FBTyxPQUFPRSxHQUFHLEVBQUVFLElBQUksS0FBSztNQUMxQixNQUFNZ0IsT0FBTyxHQUFHcEIsTUFBTSxDQUFDMUIsSUFBSSxDQUFDNEIsR0FBRyxDQUFDO01BQ2hDa0IsT0FBTyxDQUFDbkIsRUFBRSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQUNiLENBQUM7UUFBRStDO01BQUcsQ0FBQyxLQUFLO1FBQ3hDOUQsTUFBTSxDQUFDZSxDQUFDLENBQUMsQ0FBQ1osSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNqQkgsTUFBTSxDQUFDOEQsR0FBRyxDQUFDLENBQUNoQyxVQUFVLEVBQUU7UUFDeEJ5QixLQUFLLENBQUNHLE9BQU8sR0FBRyxJQUFJO01BQ3RCLENBQUMsQ0FBQztNQUNGN0IsR0FBRyxDQUFDYixNQUFNLENBQUNDLEdBQUcsQ0FBQ29DLElBQUksQ0FBQyxNQUFNO1FBQ3hCO1FBQ0FyRCxNQUFNLENBQUMrQyxPQUFPLENBQUNjLE9BQU8sQ0FBQyxDQUFDRCxTQUFTLEVBQUU7UUFDbkNiLE9BQU8sQ0FBQ0wsSUFBSSxDQUFDLGVBQWUsRUFBRTtVQUFDM0IsQ0FBQyxFQUFFO1FBQUMsQ0FBQyxDQUFDO1FBQ3JDZixNQUFNLENBQUN1RCxLQUFLLENBQUNHLE9BQU8sQ0FBQyxDQUFDRSxTQUFTLEVBQUU7TUFDbkMsQ0FBQyxDQUFDO01BQ0YsT0FBTzdCLElBQUksRUFBRTtJQUNmLENBQUM7RUFDSCxDQUFDLENBQUM7RUFFRlgsR0FBRyxDQUFDTSxVQUFVLENBQUM7SUFBQ0MsTUFBTSxFQUFFSDtFQUFvQixDQUFDLEVBQUUsQ0FBQztJQUFDRztFQUFNLENBQUMsS0FBSztJQUMzRCxPQUFPLE9BQU9FLEdBQUcsRUFBRUUsSUFBSSxLQUFLO01BQzFCLE1BQU1nQixPQUFPLEdBQUdwQixNQUFNLENBQUMxQixJQUFJLENBQUM0QixHQUFHLENBQUM7TUFDaENrQixPQUFPLENBQUNuQixFQUFFLENBQUMsY0FBYyxFQUFFLENBQUM7UUFBQ2IsQ0FBQztRQUFFK0M7TUFBRyxDQUFDLEtBQUs7UUFDdkM5RCxNQUFNLENBQUNlLENBQUMsQ0FBQyxDQUFDWixJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2pCSCxNQUFNLENBQUM4RCxHQUFHLENBQUMsQ0FBQ2hDLFVBQVUsRUFBRTtRQUN4QnlCLEtBQUssQ0FBQ0ksT0FBTyxHQUFHLElBQUk7TUFDdEIsQ0FBQyxDQUFDO01BQ0ZJLFVBQVUsQ0FBQyxNQUFNO1FBQ2Y7UUFDQS9ELE1BQU0sQ0FBQytDLE9BQU8sQ0FBQ2MsT0FBTyxDQUFDLENBQUMvQixVQUFVLEVBQUU7UUFDcENpQixPQUFPLENBQUNMLElBQUksQ0FBQyxjQUFjLEVBQUU7VUFBQzNCLENBQUMsRUFBRTtRQUFDLENBQUMsQ0FBQztRQUNwQ2YsTUFBTSxDQUFDdUQsS0FBSyxDQUFDSSxPQUFPLENBQUMsQ0FBQzdCLFVBQVUsRUFBRTtNQUNwQyxDQUFDLEVBQUUsR0FBRyxDQUFDO01BQ1AsT0FBT0MsSUFBSSxFQUFFO0lBQ2YsQ0FBQztFQUNILENBQUMsQ0FBQztFQUNGLE1BQU1vQixTQUFTLEdBQUcsSUFBQUMsNkJBQVksRUFBQ2hDLEdBQUcsQ0FBQztFQUNuQytCLFNBQVMsQ0FBQ3pDLE9BQU8sQ0FBQyxNQUFNLEVBQUU7SUFBQ0YsTUFBTSxFQUFFO0VBQU0sQ0FBQyxDQUFDO0VBRTNDdUQsVUFBVSxDQUFDLE1BQU07SUFDZi9ELE1BQU0sQ0FBQ3VELEtBQUssQ0FBQ0MsUUFBUSxDQUFDLENBQUMxQixVQUFVLEVBQUU7SUFDbkM5QixNQUFNLENBQUN1RCxLQUFLLENBQUNFLFNBQVMsQ0FBQyxDQUFDM0IsVUFBVSxFQUFFO0lBQ3BDOUIsTUFBTSxDQUFDdUQsS0FBSyxDQUFDRyxPQUFPLENBQUMsQ0FBQzVCLFVBQVUsRUFBRTtJQUNsQzlCLE1BQU0sQ0FBQ3VELEtBQUssQ0FBQ0ksT0FBTyxDQUFDLENBQUM3QixVQUFVLEVBQUU7SUFDbENPLElBQUksRUFBRTtFQUNSLENBQUMsRUFBRSxHQUFHLENBQUM7QUFDVCxDQUFDLENBQUMifQ==