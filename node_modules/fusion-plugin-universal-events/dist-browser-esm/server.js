/** Copyright (c) 2018 Uber Technologies, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

/* eslint-env node */
import { memoize } from 'fusion-core';
import Emitter from './emitter';
export class GlobalEmitter extends Emitter {
  constructor() {
    super();
    this.from = memoize(ctx => {
      return new ScopedEmitter(ctx, this);
    });
  }
  emit(type, payload, ctx) {
    payload = super.mapEvent(type, payload, this.ctx);
    super.handleEvent(type, payload, ctx);
  }
  // mirror browser api
  setFrequency() {}
  teardown() {}
}
class ScopedEmitter extends Emitter {
  constructor(ctx, parent) {
    super();
    this.ctx = ctx;
    this.parent = parent;
    this.batch = [];
    this.flushed = false;
  }
  emit(type, payload) {
    // this logic exists to manage ensuring we send events after the batch
    if (this.flushed) {
      this.handleBatchedEvent({
        type,
        payload
      });
    } else {
      this.batch.push({
        type,
        payload
      });
    }
  }
  handleBatchedEvent({
    type,
    payload
  }) {
    payload = super.mapEvent(type, payload, this.ctx);
    payload = this.parent.mapEvent(type, payload, this.ctx);
    super.handleEvent(type, payload, this.ctx);
    this.parent.handleEvent(type, payload, this.ctx);
  }
  flush() {
    for (let index = 0; index < this.batch.length; index++) {
      this.handleBatchedEvent(this.batch[index]);
    }
    this.batch = [];
    this.flushed = true;
  }
  // mirror browser api
  setFrequency() {}
  teardown() {}
}
const plugin = false && createPlugin({
  deps: {
    RouteTags: RouteTagsToken
  },
  provides: () => new GlobalEmitter(),
  middleware: (deps, globalEmitter) => {
    const bodyParser = require('koa-bodyparser');
    // Forcing to parse JSON even if the Content-Type is different because we only expect JSON
    // payloads for events and the browser sends beacons with Content-Type: 'text/plain' due to
    // this bug http://crbug.com/490015
    const parseBody = bodyParser({
      detectJSON: () => true
    });
    return async function universalEventsMiddleware(ctx, next) {
      const emitter = globalEmitter.from(ctx);
      if (ctx.method === 'POST' && ctx.path === '/_events') {
        deps.RouteTags.from(ctx).name = 'universal_events';
        await parseBody(ctx, async () => {});
        // @ts-expect-error
        const {
          items
        } = ctx.request.body;
        if (items) {
          for (let index = 0; index < items.length; index++) {
            const {
              type,
              payload
            } = items[index];
            emitter.emit(type, payload);
          }
          ctx.status = 200;
        } else {
          ctx.status = 400;
        }
      }
      // awaiting next before registering `then` on ctx.timing.end to try and get as much as possible
      // into the event batch flush.
      try {
        await next();
      } finally {
        // handle flushing in the case of an error
        ctx.timing.end.then(() => {
          emitter.flush();
        });
      }
    };
  }
});
export default plugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJtZW1vaXplIiwiRW1pdHRlciIsIkdsb2JhbEVtaXR0ZXIiLCJjb25zdHJ1Y3RvciIsImZyb20iLCJjdHgiLCJTY29wZWRFbWl0dGVyIiwiZW1pdCIsInR5cGUiLCJwYXlsb2FkIiwibWFwRXZlbnQiLCJoYW5kbGVFdmVudCIsInNldEZyZXF1ZW5jeSIsInRlYXJkb3duIiwicGFyZW50IiwiYmF0Y2giLCJmbHVzaGVkIiwiaGFuZGxlQmF0Y2hlZEV2ZW50IiwicHVzaCIsImZsdXNoIiwiaW5kZXgiLCJsZW5ndGgiLCJwbHVnaW4iLCJjcmVhdGVQbHVnaW4iLCJkZXBzIiwiUm91dGVUYWdzIiwiUm91dGVUYWdzVG9rZW4iLCJwcm92aWRlcyIsIm1pZGRsZXdhcmUiLCJnbG9iYWxFbWl0dGVyIiwiYm9keVBhcnNlciIsInJlcXVpcmUiLCJwYXJzZUJvZHkiLCJkZXRlY3RKU09OIiwidW5pdmVyc2FsRXZlbnRzTWlkZGxld2FyZSIsIm5leHQiLCJlbWl0dGVyIiwibWV0aG9kIiwicGF0aCIsIm5hbWUiLCJpdGVtcyIsInJlcXVlc3QiLCJib2R5Iiwic3RhdHVzIiwidGltaW5nIiwiZW5kIiwidGhlbiJdLCJzb3VyY2VzIjpbInNyYy9zZXJ2ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqIENvcHlyaWdodCAoYykgMjAxOCBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqL1xuXG4vKiBlc2xpbnQtZW52IG5vZGUgKi9cbmltcG9ydCB7bWVtb2l6ZSwgY3JlYXRlUGx1Z2luLCBSb3V0ZVRhZ3NUb2tlbn0gZnJvbSAnZnVzaW9uLWNvcmUnO1xuaW1wb3J0IHR5cGUge0Z1c2lvblBsdWdpbiwgQ29udGV4dH0gZnJvbSAnZnVzaW9uLWNvcmUnO1xuXG5pbXBvcnQgRW1pdHRlciBmcm9tICcuL2VtaXR0ZXInO1xuaW1wb3J0IHR5cGUge1xuICBJRW1pdHRlcixcbiAgVW5pdmVyc2FsRXZlbnRzUGx1Z2luRGVwc1R5cGUgYXMgRGVwc1R5cGUsXG59IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgY2xhc3MgR2xvYmFsRW1pdHRlciBleHRlbmRzIEVtaXR0ZXIge1xuICBmcm9tOiAoY3R4OiBDb250ZXh0KSA9PiBTY29wZWRFbWl0dGVyO1xuICBjdHg6IENvbnRleHQ7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmZyb20gPSBtZW1vaXplKChjdHgpID0+IHtcbiAgICAgIHJldHVybiBuZXcgU2NvcGVkRW1pdHRlcihjdHgsIHRoaXMpO1xuICAgIH0pO1xuICB9XG4gIGVtaXQodHlwZTogc3RyaW5nLCBwYXlsb2FkOiB1bmtub3duLCBjdHg/OiBDb250ZXh0KTogdm9pZCB7XG4gICAgcGF5bG9hZCA9IHN1cGVyLm1hcEV2ZW50KHR5cGUsIHBheWxvYWQsIHRoaXMuY3R4KTtcbiAgICBzdXBlci5oYW5kbGVFdmVudCh0eXBlLCBwYXlsb2FkLCBjdHgpO1xuICB9XG4gIC8vIG1pcnJvciBicm93c2VyIGFwaVxuICBzZXRGcmVxdWVuY3koKSB7fVxuICB0ZWFyZG93bigpIHt9XG59XG5cbmNsYXNzIFNjb3BlZEVtaXR0ZXIgZXh0ZW5kcyBFbWl0dGVyIHtcbiAgY3R4OiBDb250ZXh0O1xuICBwYXJlbnQ6IEdsb2JhbEVtaXR0ZXI7XG4gIGJhdGNoOiBBcnJheTx7XG4gICAgdHlwZTogc3RyaW5nO1xuICAgIHBheWxvYWQ6IGFueTtcbiAgfT47XG4gIGZsdXNoZWQ6IGJvb2xlYW47XG5cbiAgY29uc3RydWN0b3IoY3R4OiBDb250ZXh0LCBwYXJlbnQ6IEdsb2JhbEVtaXR0ZXIpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuY3R4ID0gY3R4O1xuICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICAgIHRoaXMuYmF0Y2ggPSBbXTtcbiAgICB0aGlzLmZsdXNoZWQgPSBmYWxzZTtcbiAgfVxuICBlbWl0KHR5cGU6IHN0cmluZywgcGF5bG9hZDogdW5rbm93bikge1xuICAgIC8vIHRoaXMgbG9naWMgZXhpc3RzIHRvIG1hbmFnZSBlbnN1cmluZyB3ZSBzZW5kIGV2ZW50cyBhZnRlciB0aGUgYmF0Y2hcbiAgICBpZiAodGhpcy5mbHVzaGVkKSB7XG4gICAgICB0aGlzLmhhbmRsZUJhdGNoZWRFdmVudCh7dHlwZSwgcGF5bG9hZH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmJhdGNoLnB1c2goe3R5cGUsIHBheWxvYWR9KTtcbiAgICB9XG4gIH1cbiAgaGFuZGxlQmF0Y2hlZEV2ZW50KHt0eXBlLCBwYXlsb2FkfToge3R5cGU6IHN0cmluZzsgcGF5bG9hZDogdW5rbm93bn0pIHtcbiAgICBwYXlsb2FkID0gc3VwZXIubWFwRXZlbnQodHlwZSwgcGF5bG9hZCwgdGhpcy5jdHgpO1xuICAgIHBheWxvYWQgPSB0aGlzLnBhcmVudC5tYXBFdmVudCh0eXBlLCBwYXlsb2FkLCB0aGlzLmN0eCk7XG4gICAgc3VwZXIuaGFuZGxlRXZlbnQodHlwZSwgcGF5bG9hZCwgdGhpcy5jdHgpO1xuICAgIHRoaXMucGFyZW50LmhhbmRsZUV2ZW50KHR5cGUsIHBheWxvYWQsIHRoaXMuY3R4KTtcbiAgfVxuICBmbHVzaCgpIHtcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5iYXRjaC5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIHRoaXMuaGFuZGxlQmF0Y2hlZEV2ZW50KHRoaXMuYmF0Y2hbaW5kZXhdKTtcbiAgICB9XG4gICAgdGhpcy5iYXRjaCA9IFtdO1xuICAgIHRoaXMuZmx1c2hlZCA9IHRydWU7XG4gIH1cbiAgLy8gbWlycm9yIGJyb3dzZXIgYXBpXG4gIHNldEZyZXF1ZW5jeSgpIHt9XG4gIHRlYXJkb3duKCkge31cbn1cblxuY29uc3QgcGx1Z2luID1cbiAgX19OT0RFX18gJiZcbiAgY3JlYXRlUGx1Z2luKHtcbiAgICBkZXBzOiB7XG4gICAgICBSb3V0ZVRhZ3M6IFJvdXRlVGFnc1Rva2VuLFxuICAgIH0sXG4gICAgcHJvdmlkZXM6ICgpID0+IG5ldyBHbG9iYWxFbWl0dGVyKCksXG4gICAgbWlkZGxld2FyZTogKGRlcHMsIGdsb2JhbEVtaXR0ZXIpID0+IHtcbiAgICAgIGNvbnN0IGJvZHlQYXJzZXIgPSByZXF1aXJlKCdrb2EtYm9keXBhcnNlcicpO1xuICAgICAgLy8gRm9yY2luZyB0byBwYXJzZSBKU09OIGV2ZW4gaWYgdGhlIENvbnRlbnQtVHlwZSBpcyBkaWZmZXJlbnQgYmVjYXVzZSB3ZSBvbmx5IGV4cGVjdCBKU09OXG4gICAgICAvLyBwYXlsb2FkcyBmb3IgZXZlbnRzIGFuZCB0aGUgYnJvd3NlciBzZW5kcyBiZWFjb25zIHdpdGggQ29udGVudC1UeXBlOiAndGV4dC9wbGFpbicgZHVlIHRvXG4gICAgICAvLyB0aGlzIGJ1ZyBodHRwOi8vY3JidWcuY29tLzQ5MDAxNVxuICAgICAgY29uc3QgcGFyc2VCb2R5ID0gYm9keVBhcnNlcih7ZGV0ZWN0SlNPTjogKCkgPT4gdHJ1ZX0pO1xuICAgICAgcmV0dXJuIGFzeW5jIGZ1bmN0aW9uIHVuaXZlcnNhbEV2ZW50c01pZGRsZXdhcmUoY3R4LCBuZXh0KSB7XG4gICAgICAgIGNvbnN0IGVtaXR0ZXIgPSBnbG9iYWxFbWl0dGVyLmZyb20oY3R4KTtcbiAgICAgICAgaWYgKGN0eC5tZXRob2QgPT09ICdQT1NUJyAmJiBjdHgucGF0aCA9PT0gJy9fZXZlbnRzJykge1xuICAgICAgICAgIGRlcHMuUm91dGVUYWdzLmZyb20oY3R4KS5uYW1lID0gJ3VuaXZlcnNhbF9ldmVudHMnO1xuICAgICAgICAgIGF3YWl0IHBhcnNlQm9keShjdHgsIGFzeW5jICgpID0+IHt9KTtcbiAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gICAgICAgICAgY29uc3Qge2l0ZW1zfSA9IGN0eC5yZXF1ZXN0LmJvZHk7XG4gICAgICAgICAgaWYgKGl0ZW1zKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgaXRlbXMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHt0eXBlLCBwYXlsb2FkfSA9IGl0ZW1zW2luZGV4XTtcbiAgICAgICAgICAgICAgZW1pdHRlci5lbWl0KHR5cGUsIHBheWxvYWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY3R4LnN0YXR1cyA9IDIwMDtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY3R4LnN0YXR1cyA9IDQwMDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gYXdhaXRpbmcgbmV4dCBiZWZvcmUgcmVnaXN0ZXJpbmcgYHRoZW5gIG9uIGN0eC50aW1pbmcuZW5kIHRvIHRyeSBhbmQgZ2V0IGFzIG11Y2ggYXMgcG9zc2libGVcbiAgICAgICAgLy8gaW50byB0aGUgZXZlbnQgYmF0Y2ggZmx1c2guXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgbmV4dCgpO1xuICAgICAgICB9IGZpbmFsbHkge1xuICAgICAgICAgIC8vIGhhbmRsZSBmbHVzaGluZyBpbiB0aGUgY2FzZSBvZiBhbiBlcnJvclxuICAgICAgICAgIGN0eC50aW1pbmcuZW5kLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgZW1pdHRlci5mbHVzaCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0sXG4gIH0pO1xuXG5leHBvcnQgZGVmYXVsdCBwbHVnaW4gYXMgYW55IGFzIEZ1c2lvblBsdWdpbjxEZXBzVHlwZSwgSUVtaXR0ZXI+O1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFRQSxPQUFPLFFBQXFDLGFBQWE7QUFHakUsT0FBT0MsT0FBTyxNQUFNLFdBQVc7QUFNL0IsT0FBTyxNQUFNQyxhQUFhLFNBQVNELE9BQU8sQ0FBQztFQUl6Q0UsV0FBVyxHQUFHO0lBQ1osS0FBSyxFQUFFO0lBQ1AsSUFBSSxDQUFDQyxJQUFJLEdBQUdKLE9BQU8sQ0FBRUssR0FBRyxJQUFLO01BQzNCLE9BQU8sSUFBSUMsYUFBYSxDQUFDRCxHQUFHLEVBQUUsSUFBSSxDQUFDO0lBQ3JDLENBQUMsQ0FBQztFQUNKO0VBQ0FFLElBQUksQ0FBQ0MsSUFBWSxFQUFFQyxPQUFnQixFQUFFSixHQUFhLEVBQVE7SUFDeERJLE9BQU8sR0FBRyxLQUFLLENBQUNDLFFBQVEsQ0FBQ0YsSUFBSSxFQUFFQyxPQUFPLEVBQUUsSUFBSSxDQUFDSixHQUFHLENBQUM7SUFDakQsS0FBSyxDQUFDTSxXQUFXLENBQUNILElBQUksRUFBRUMsT0FBTyxFQUFFSixHQUFHLENBQUM7RUFDdkM7RUFDQTtFQUNBTyxZQUFZLEdBQUcsQ0FBQztFQUNoQkMsUUFBUSxHQUFHLENBQUM7QUFDZDtBQUVBLE1BQU1QLGFBQWEsU0FBU0wsT0FBTyxDQUFDO0VBU2xDRSxXQUFXLENBQUNFLEdBQVksRUFBRVMsTUFBcUIsRUFBRTtJQUMvQyxLQUFLLEVBQUU7SUFDUCxJQUFJLENBQUNULEdBQUcsR0FBR0EsR0FBRztJQUNkLElBQUksQ0FBQ1MsTUFBTSxHQUFHQSxNQUFNO0lBQ3BCLElBQUksQ0FBQ0MsS0FBSyxHQUFHLEVBQUU7SUFDZixJQUFJLENBQUNDLE9BQU8sR0FBRyxLQUFLO0VBQ3RCO0VBQ0FULElBQUksQ0FBQ0MsSUFBWSxFQUFFQyxPQUFnQixFQUFFO0lBQ25DO0lBQ0EsSUFBSSxJQUFJLENBQUNPLE9BQU8sRUFBRTtNQUNoQixJQUFJLENBQUNDLGtCQUFrQixDQUFDO1FBQUNULElBQUk7UUFBRUM7TUFBTyxDQUFDLENBQUM7SUFDMUMsQ0FBQyxNQUFNO01BQ0wsSUFBSSxDQUFDTSxLQUFLLENBQUNHLElBQUksQ0FBQztRQUFDVixJQUFJO1FBQUVDO01BQU8sQ0FBQyxDQUFDO0lBQ2xDO0VBQ0Y7RUFDQVEsa0JBQWtCLENBQUM7SUFBQ1QsSUFBSTtJQUFFQztFQUF5QyxDQUFDLEVBQUU7SUFDcEVBLE9BQU8sR0FBRyxLQUFLLENBQUNDLFFBQVEsQ0FBQ0YsSUFBSSxFQUFFQyxPQUFPLEVBQUUsSUFBSSxDQUFDSixHQUFHLENBQUM7SUFDakRJLE9BQU8sR0FBRyxJQUFJLENBQUNLLE1BQU0sQ0FBQ0osUUFBUSxDQUFDRixJQUFJLEVBQUVDLE9BQU8sRUFBRSxJQUFJLENBQUNKLEdBQUcsQ0FBQztJQUN2RCxLQUFLLENBQUNNLFdBQVcsQ0FBQ0gsSUFBSSxFQUFFQyxPQUFPLEVBQUUsSUFBSSxDQUFDSixHQUFHLENBQUM7SUFDMUMsSUFBSSxDQUFDUyxNQUFNLENBQUNILFdBQVcsQ0FBQ0gsSUFBSSxFQUFFQyxPQUFPLEVBQUUsSUFBSSxDQUFDSixHQUFHLENBQUM7RUFDbEQ7RUFDQWMsS0FBSyxHQUFHO0lBQ04sS0FBSyxJQUFJQyxLQUFLLEdBQUcsQ0FBQyxFQUFFQSxLQUFLLEdBQUcsSUFBSSxDQUFDTCxLQUFLLENBQUNNLE1BQU0sRUFBRUQsS0FBSyxFQUFFLEVBQUU7TUFDdEQsSUFBSSxDQUFDSCxrQkFBa0IsQ0FBQyxJQUFJLENBQUNGLEtBQUssQ0FBQ0ssS0FBSyxDQUFDLENBQUM7SUFDNUM7SUFDQSxJQUFJLENBQUNMLEtBQUssR0FBRyxFQUFFO0lBQ2YsSUFBSSxDQUFDQyxPQUFPLEdBQUcsSUFBSTtFQUNyQjtFQUNBO0VBQ0FKLFlBQVksR0FBRyxDQUFDO0VBQ2hCQyxRQUFRLEdBQUcsQ0FBQztBQUNkO0FBRUEsTUFBTVMsTUFBTSxHQUNWLFNBQ0FDLFlBQVksQ0FBQztFQUNYQyxJQUFJLEVBQUU7SUFDSkMsU0FBUyxFQUFFQztFQUNiLENBQUM7RUFDREMsUUFBUSxFQUFFLE1BQU0sSUFBSXpCLGFBQWEsRUFBRTtFQUNuQzBCLFVBQVUsRUFBRSxDQUFDSixJQUFJLEVBQUVLLGFBQWEsS0FBSztJQUNuQyxNQUFNQyxVQUFVLEdBQUdDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQztJQUM1QztJQUNBO0lBQ0E7SUFDQSxNQUFNQyxTQUFTLEdBQUdGLFVBQVUsQ0FBQztNQUFDRyxVQUFVLEVBQUUsTUFBTTtJQUFJLENBQUMsQ0FBQztJQUN0RCxPQUFPLGVBQWVDLHlCQUF5QixDQUFDN0IsR0FBRyxFQUFFOEIsSUFBSSxFQUFFO01BQ3pELE1BQU1DLE9BQU8sR0FBR1AsYUFBYSxDQUFDekIsSUFBSSxDQUFDQyxHQUFHLENBQUM7TUFDdkMsSUFBSUEsR0FBRyxDQUFDZ0MsTUFBTSxLQUFLLE1BQU0sSUFBSWhDLEdBQUcsQ0FBQ2lDLElBQUksS0FBSyxVQUFVLEVBQUU7UUFDcERkLElBQUksQ0FBQ0MsU0FBUyxDQUFDckIsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQ2tDLElBQUksR0FBRyxrQkFBa0I7UUFDbEQsTUFBTVAsU0FBUyxDQUFDM0IsR0FBRyxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUM7UUFDcEM7UUFDQSxNQUFNO1VBQUNtQztRQUFLLENBQUMsR0FBR25DLEdBQUcsQ0FBQ29DLE9BQU8sQ0FBQ0MsSUFBSTtRQUNoQyxJQUFJRixLQUFLLEVBQUU7VUFDVCxLQUFLLElBQUlwQixLQUFLLEdBQUcsQ0FBQyxFQUFFQSxLQUFLLEdBQUdvQixLQUFLLENBQUNuQixNQUFNLEVBQUVELEtBQUssRUFBRSxFQUFFO1lBQ2pELE1BQU07Y0FBQ1osSUFBSTtjQUFFQztZQUFPLENBQUMsR0FBRytCLEtBQUssQ0FBQ3BCLEtBQUssQ0FBQztZQUNwQ2dCLE9BQU8sQ0FBQzdCLElBQUksQ0FBQ0MsSUFBSSxFQUFFQyxPQUFPLENBQUM7VUFDN0I7VUFDQUosR0FBRyxDQUFDc0MsTUFBTSxHQUFHLEdBQUc7UUFDbEIsQ0FBQyxNQUFNO1VBQ0x0QyxHQUFHLENBQUNzQyxNQUFNLEdBQUcsR0FBRztRQUNsQjtNQUNGO01BQ0E7TUFDQTtNQUNBLElBQUk7UUFDRixNQUFNUixJQUFJLEVBQUU7TUFDZCxDQUFDLFNBQVM7UUFDUjtRQUNBOUIsR0FBRyxDQUFDdUMsTUFBTSxDQUFDQyxHQUFHLENBQUNDLElBQUksQ0FBQyxNQUFNO1VBQ3hCVixPQUFPLENBQUNqQixLQUFLLEVBQUU7UUFDakIsQ0FBQyxDQUFDO01BQ0o7SUFDRixDQUFDO0VBQ0g7QUFDRixDQUFDLENBQUM7QUFFSixlQUFlRyxNQUFNIn0=