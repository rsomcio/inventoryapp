"use strict";

var React = _interopRequireWildcard(require("react"));

var _index = require("../../index.js");

function _getRequireWildcardCache() { if (typeof WeakMap !== "function") return null; var cache = new WeakMap(); _getRequireWildcardCache = function () { return cache; }; return cache; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

/** Copyright (c) 2018 Uber Technologies, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * 
 */

/* eslint-disable react/no-multi-comp */
test('Preparing a sync app passing through context', done => {
  let numConstructors = 0;
  let numRenders = 0;
  let numChildRenders = 0;

  class SimpleComponent extends React.Component {
    constructor(props, context) {
      super(props, context);
      numConstructors++;
    }

    getChildContext() {
      return {
        test: 'data'
      };
    }

    render() {
      numRenders++;
      return React.createElement(SimplePresentational, null);
    }

  }

  SimpleComponent.childContextTypes = {
    test: () => {}
  };

  function SimplePresentational(props, context) {
    expect(context.test).toBe('data');
    numChildRenders++;
    return React.createElement("div", null, "Hello World");
  }

  SimplePresentational.contextTypes = {
    test: () => {}
  };
  const app = React.createElement(SimpleComponent, null);
  const p = (0, _index.prepare)(app);
  expect(p instanceof Promise).toBeTruthy();
  p.then(() => {
    expect(numConstructors).toBe(1);
    expect(numRenders).toBe(1);
    expect(numChildRenders).toBe(1);
    done();
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByZXBhcmUtY29udGV4dC5ub2RlLmpzIl0sIm5hbWVzIjpbInRlc3QiLCJkb25lIiwibnVtQ29uc3RydWN0b3JzIiwibnVtUmVuZGVycyIsIm51bUNoaWxkUmVuZGVycyIsIlNpbXBsZUNvbXBvbmVudCIsIlJlYWN0IiwiQ29tcG9uZW50IiwiY29uc3RydWN0b3IiLCJwcm9wcyIsImNvbnRleHQiLCJnZXRDaGlsZENvbnRleHQiLCJyZW5kZXIiLCJjaGlsZENvbnRleHRUeXBlcyIsIlNpbXBsZVByZXNlbnRhdGlvbmFsIiwiZXhwZWN0IiwidG9CZSIsImNvbnRleHRUeXBlcyIsImFwcCIsInAiLCJQcm9taXNlIiwidG9CZVRydXRoeSIsInRoZW4iXSwibWFwcGluZ3MiOiI7O0FBU0E7O0FBQ0E7Ozs7OztBQVZBOzs7Ozs7OztBQVFBO0FBSUFBLElBQUksQ0FBQyw4Q0FBRCxFQUFpREMsSUFBSSxJQUFJO0FBQzNELE1BQUlDLGVBQWUsR0FBRyxDQUF0QjtBQUNBLE1BQUlDLFVBQVUsR0FBRyxDQUFqQjtBQUNBLE1BQUlDLGVBQWUsR0FBRyxDQUF0Qjs7QUFDQSxRQUFNQyxlQUFOLFNBQThCQyxLQUFLLENBQUNDLFNBQXBDLENBQXdEO0FBQ3REQyxJQUFBQSxXQUFXLENBQUNDLEtBQUQsRUFBUUMsT0FBUixFQUFpQjtBQUMxQixZQUFNRCxLQUFOLEVBQWFDLE9BQWI7QUFDQVIsTUFBQUEsZUFBZTtBQUNoQjs7QUFDRFMsSUFBQUEsZUFBZSxHQUFHO0FBQ2hCLGFBQU87QUFDTFgsUUFBQUEsSUFBSSxFQUFFO0FBREQsT0FBUDtBQUdEOztBQUNEWSxJQUFBQSxNQUFNLEdBQUc7QUFDUFQsTUFBQUEsVUFBVTtBQUNWLGFBQU8sb0JBQUMsb0JBQUQsT0FBUDtBQUNEOztBQWJxRDs7QUFleERFLEVBQUFBLGVBQWUsQ0FBQ1EsaUJBQWhCLEdBQW9DO0FBQ2xDYixJQUFBQSxJQUFJLEVBQUUsTUFBTSxDQUFFO0FBRG9CLEdBQXBDOztBQUdBLFdBQVNjLG9CQUFULENBQThCTCxLQUE5QixFQUFxQ0MsT0FBckMsRUFBOEM7QUFDNUNLLElBQUFBLE1BQU0sQ0FBQ0wsT0FBTyxDQUFDVixJQUFULENBQU4sQ0FBcUJnQixJQUFyQixDQUEwQixNQUExQjtBQUNBWixJQUFBQSxlQUFlO0FBQ2YsV0FBTywrQ0FBUDtBQUNEOztBQUNEVSxFQUFBQSxvQkFBb0IsQ0FBQ0csWUFBckIsR0FBb0M7QUFDbENqQixJQUFBQSxJQUFJLEVBQUUsTUFBTSxDQUFFO0FBRG9CLEdBQXBDO0FBR0EsUUFBTWtCLEdBQUcsR0FBRyxvQkFBQyxlQUFELE9BQVo7QUFDQSxRQUFNQyxDQUFDLEdBQUcsb0JBQVFELEdBQVIsQ0FBVjtBQUNBSCxFQUFBQSxNQUFNLENBQUNJLENBQUMsWUFBWUMsT0FBZCxDQUFOLENBQTZCQyxVQUE3QjtBQUNBRixFQUFBQSxDQUFDLENBQUNHLElBQUYsQ0FBTyxNQUFNO0FBQ1hQLElBQUFBLE1BQU0sQ0FBQ2IsZUFBRCxDQUFOLENBQXdCYyxJQUF4QixDQUE2QixDQUE3QjtBQUNBRCxJQUFBQSxNQUFNLENBQUNaLFVBQUQsQ0FBTixDQUFtQmEsSUFBbkIsQ0FBd0IsQ0FBeEI7QUFDQUQsSUFBQUEsTUFBTSxDQUFDWCxlQUFELENBQU4sQ0FBd0JZLElBQXhCLENBQTZCLENBQTdCO0FBQ0FmLElBQUFBLElBQUk7QUFDTCxHQUxEO0FBTUQsQ0F2Q0csQ0FBSiIsInNvdXJjZXNDb250ZW50IjpbIi8qKiBDb3B5cmlnaHQgKGMpIDIwMTggVWJlciBUZWNobm9sb2dpZXMsIEluYy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvd1xuICovXG5cbi8qIGVzbGludC1kaXNhYmxlIHJlYWN0L25vLW11bHRpLWNvbXAgKi9cbmltcG9ydCAqIGFzIFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7cHJlcGFyZX0gZnJvbSAnLi4vLi4vaW5kZXguanMnO1xuXG50ZXN0KCdQcmVwYXJpbmcgYSBzeW5jIGFwcCBwYXNzaW5nIHRocm91Z2ggY29udGV4dCcsIGRvbmUgPT4ge1xuICBsZXQgbnVtQ29uc3RydWN0b3JzID0gMDtcbiAgbGV0IG51bVJlbmRlcnMgPSAwO1xuICBsZXQgbnVtQ2hpbGRSZW5kZXJzID0gMDtcbiAgY2xhc3MgU2ltcGxlQ29tcG9uZW50IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PGFueSwgYW55PiB7XG4gICAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICAgIHN1cGVyKHByb3BzLCBjb250ZXh0KTtcbiAgICAgIG51bUNvbnN0cnVjdG9ycysrO1xuICAgIH1cbiAgICBnZXRDaGlsZENvbnRleHQoKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0ZXN0OiAnZGF0YScsXG4gICAgICB9O1xuICAgIH1cbiAgICByZW5kZXIoKSB7XG4gICAgICBudW1SZW5kZXJzKys7XG4gICAgICByZXR1cm4gPFNpbXBsZVByZXNlbnRhdGlvbmFsIC8+O1xuICAgIH1cbiAgfVxuICBTaW1wbGVDb21wb25lbnQuY2hpbGRDb250ZXh0VHlwZXMgPSB7XG4gICAgdGVzdDogKCkgPT4ge30sXG4gIH07XG4gIGZ1bmN0aW9uIFNpbXBsZVByZXNlbnRhdGlvbmFsKHByb3BzLCBjb250ZXh0KSB7XG4gICAgZXhwZWN0KGNvbnRleHQudGVzdCkudG9CZSgnZGF0YScpO1xuICAgIG51bUNoaWxkUmVuZGVycysrO1xuICAgIHJldHVybiA8ZGl2PkhlbGxvIFdvcmxkPC9kaXY+O1xuICB9XG4gIFNpbXBsZVByZXNlbnRhdGlvbmFsLmNvbnRleHRUeXBlcyA9IHtcbiAgICB0ZXN0OiAoKSA9PiB7fSxcbiAgfTtcbiAgY29uc3QgYXBwID0gPFNpbXBsZUNvbXBvbmVudCAvPjtcbiAgY29uc3QgcCA9IHByZXBhcmUoYXBwKTtcbiAgZXhwZWN0KHAgaW5zdGFuY2VvZiBQcm9taXNlKS50b0JlVHJ1dGh5KCk7XG4gIHAudGhlbigoKSA9PiB7XG4gICAgZXhwZWN0KG51bUNvbnN0cnVjdG9ycykudG9CZSgxKTtcbiAgICBleHBlY3QobnVtUmVuZGVycykudG9CZSgxKTtcbiAgICBleHBlY3QobnVtQ2hpbGRSZW5kZXJzKS50b0JlKDEpO1xuICAgIGRvbmUoKTtcbiAgfSk7XG59KTtcbiJdfQ==