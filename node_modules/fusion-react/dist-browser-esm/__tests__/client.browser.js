/** Copyright (c) 2018 Uber Technologies, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * 
 */

/* eslint-env browser */
import * as React from 'react';
import { getSimulator } from 'fusion-test-utils';
import render from '../client';
import App from '../index';
test('renders', () => {
  const root = setup();
  render(React.createElement('span', null, 'hello'));
  expect(root.firstChild).toBeTruthy();
  const firstChild = root.firstChild;
  expect(firstChild.nodeName).toBe('SPAN');
  expect(firstChild.textContent).toBe('hello');
  cleanup(root);
});
test('client side app', async done => {
  const root = setup();
  const app = new App(React.createElement('span', null, 'hello'));
  const simulator = getSimulator(app);

  try {
    const ctx = await simulator.render('/');
    expect(ctx.rendered).toBeTruthy();
    expect(ctx.element).toBeTruthy();
    expect(root.firstChild).toBeTruthy();
    const firstChild = root.firstChild;
    expect(firstChild.nodeName).toBe('SPAN');
    expect(firstChild.textContent).toBe('hello');
  } catch (e) {
    expect(e).toBeFalsy();
  } finally {
    cleanup(root);
    done();
  }
});

function setup() {
  const root = document.createElement('div');
  root.id = 'root';
  document.body && document.body.appendChild(root);
  return root;
}

function cleanup(root) {
  document.body && document.body.removeChild(root);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNsaWVudC5icm93c2VyLmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwiZ2V0U2ltdWxhdG9yIiwicmVuZGVyIiwiQXBwIiwidGVzdCIsInJvb3QiLCJzZXR1cCIsImNyZWF0ZUVsZW1lbnQiLCJleHBlY3QiLCJmaXJzdENoaWxkIiwidG9CZVRydXRoeSIsIm5vZGVOYW1lIiwidG9CZSIsInRleHRDb250ZW50IiwiY2xlYW51cCIsImRvbmUiLCJhcHAiLCJzaW11bGF0b3IiLCJjdHgiLCJyZW5kZXJlZCIsImVsZW1lbnQiLCJlIiwidG9CZUZhbHN5IiwiZG9jdW1lbnQiLCJpZCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsInJlbW92ZUNoaWxkIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7QUFRQTtBQUVBLE9BQU8sS0FBS0EsS0FBWixNQUF1QixPQUF2QjtBQUNBLFNBQVFDLFlBQVIsUUFBMkIsbUJBQTNCO0FBQ0EsT0FBT0MsTUFBUCxNQUFtQixXQUFuQjtBQUNBLE9BQU9DLEdBQVAsTUFBZ0IsVUFBaEI7QUFFQUMsSUFBSSxDQUFDLFNBQUQsRUFBWSxNQUFNO0FBQ3BCLFFBQU1DLElBQUksR0FBR0MsS0FBSyxFQUFsQjtBQUVBSixFQUFBQSxNQUFNLENBQUNGLEtBQUssQ0FBQ08sYUFBTixDQUFvQixNQUFwQixFQUE0QixJQUE1QixFQUFrQyxPQUFsQyxDQUFELENBQU47QUFDQUMsRUFBQUEsTUFBTSxDQUFDSCxJQUFJLENBQUNJLFVBQU4sQ0FBTixDQUF3QkMsVUFBeEI7QUFDQSxRQUFNRCxVQUFVLEdBQUtKLElBQUksQ0FBQ0ksVUFBMUI7QUFDQUQsRUFBQUEsTUFBTSxDQUFDQyxVQUFVLENBQUNFLFFBQVosQ0FBTixDQUE0QkMsSUFBNUIsQ0FBaUMsTUFBakM7QUFDQUosRUFBQUEsTUFBTSxDQUFDQyxVQUFVLENBQUNJLFdBQVosQ0FBTixDQUErQkQsSUFBL0IsQ0FBb0MsT0FBcEM7QUFFQUUsRUFBQUEsT0FBTyxDQUFDVCxJQUFELENBQVA7QUFDRCxDQVZHLENBQUo7QUFZQUQsSUFBSSxDQUFDLGlCQUFELEVBQW9CLE1BQU1XLElBQU4sSUFBYztBQUNwQyxRQUFNVixJQUFJLEdBQUdDLEtBQUssRUFBbEI7QUFFQSxRQUFNVSxHQUFHLEdBQUcsSUFBSWIsR0FBSixDQUFRSCxLQUFLLENBQUNPLGFBQU4sQ0FBb0IsTUFBcEIsRUFBNEIsSUFBNUIsRUFBa0MsT0FBbEMsQ0FBUixDQUFaO0FBQ0EsUUFBTVUsU0FBUyxHQUFHaEIsWUFBWSxDQUFDZSxHQUFELENBQTlCOztBQUNBLE1BQUk7QUFDRixVQUFNRSxHQUFHLEdBQUcsTUFBTUQsU0FBUyxDQUFDZixNQUFWLENBQWlCLEdBQWpCLENBQWxCO0FBQ0FNLElBQUFBLE1BQU0sQ0FBQ1UsR0FBRyxDQUFDQyxRQUFMLENBQU4sQ0FBcUJULFVBQXJCO0FBQ0FGLElBQUFBLE1BQU0sQ0FBQ1UsR0FBRyxDQUFDRSxPQUFMLENBQU4sQ0FBb0JWLFVBQXBCO0FBQ0FGLElBQUFBLE1BQU0sQ0FBQ0gsSUFBSSxDQUFDSSxVQUFOLENBQU4sQ0FBd0JDLFVBQXhCO0FBQ0EsVUFBTUQsVUFBVSxHQUFLSixJQUFJLENBQUNJLFVBQTFCO0FBQ0FELElBQUFBLE1BQU0sQ0FBQ0MsVUFBVSxDQUFDRSxRQUFaLENBQU4sQ0FBNEJDLElBQTVCLENBQWlDLE1BQWpDO0FBQ0FKLElBQUFBLE1BQU0sQ0FBQ0MsVUFBVSxDQUFDSSxXQUFaLENBQU4sQ0FBK0JELElBQS9CLENBQW9DLE9BQXBDO0FBQ0QsR0FSRCxDQVFFLE9BQU9TLENBQVAsRUFBVTtBQUNWYixJQUFBQSxNQUFNLENBQUNhLENBQUQsQ0FBTixDQUFVQyxTQUFWO0FBQ0QsR0FWRCxTQVVVO0FBQ1JSLElBQUFBLE9BQU8sQ0FBQ1QsSUFBRCxDQUFQO0FBQ0FVLElBQUFBLElBQUk7QUFDTDtBQUNGLENBbkJHLENBQUo7O0FBcUJBLFNBQVNULEtBQVQsR0FBaUI7QUFDZixRQUFNRCxJQUFJLEdBQUdrQixRQUFRLENBQUNoQixhQUFULENBQXVCLEtBQXZCLENBQWI7QUFDQUYsRUFBQUEsSUFBSSxDQUFDbUIsRUFBTCxHQUFVLE1BQVY7QUFDQUQsRUFBQUEsUUFBUSxDQUFDRSxJQUFULElBQWlCRixRQUFRLENBQUNFLElBQVQsQ0FBY0MsV0FBZCxDQUEwQnJCLElBQTFCLENBQWpCO0FBQ0EsU0FBT0EsSUFBUDtBQUNEOztBQUVELFNBQVNTLE9BQVQsQ0FBaUJULElBQWpCLEVBQXVCO0FBQ3JCa0IsRUFBQUEsUUFBUSxDQUFDRSxJQUFULElBQWlCRixRQUFRLENBQUNFLElBQVQsQ0FBY0UsV0FBZCxDQUEwQnRCLElBQTFCLENBQWpCO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKiogQ29weXJpZ2h0IChjKSAyMDE4IFViZXIgVGVjaG5vbG9naWVzLCBJbmMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqL1xuXG4vKiBlc2xpbnQtZW52IGJyb3dzZXIgKi9cblxuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtnZXRTaW11bGF0b3J9IGZyb20gJ2Z1c2lvbi10ZXN0LXV0aWxzJztcbmltcG9ydCByZW5kZXIgZnJvbSAnLi4vY2xpZW50JztcbmltcG9ydCBBcHAgZnJvbSAnLi4vaW5kZXgnO1xuXG50ZXN0KCdyZW5kZXJzJywgKCkgPT4ge1xuICBjb25zdCByb290ID0gc2V0dXAoKTtcblxuICByZW5kZXIoUmVhY3QuY3JlYXRlRWxlbWVudCgnc3BhbicsIG51bGwsICdoZWxsbycpKTtcbiAgZXhwZWN0KHJvb3QuZmlyc3RDaGlsZCkudG9CZVRydXRoeSgpO1xuICBjb25zdCBmaXJzdENoaWxkID0gKChyb290LmZpcnN0Q2hpbGQ6IGFueSk6IE5vZGUpO1xuICBleHBlY3QoZmlyc3RDaGlsZC5ub2RlTmFtZSkudG9CZSgnU1BBTicpO1xuICBleHBlY3QoZmlyc3RDaGlsZC50ZXh0Q29udGVudCkudG9CZSgnaGVsbG8nKTtcblxuICBjbGVhbnVwKHJvb3QpO1xufSk7XG5cbnRlc3QoJ2NsaWVudCBzaWRlIGFwcCcsIGFzeW5jIGRvbmUgPT4ge1xuICBjb25zdCByb290ID0gc2V0dXAoKTtcblxuICBjb25zdCBhcHAgPSBuZXcgQXBwKFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nLCBudWxsLCAnaGVsbG8nKSk7XG4gIGNvbnN0IHNpbXVsYXRvciA9IGdldFNpbXVsYXRvcihhcHApO1xuICB0cnkge1xuICAgIGNvbnN0IGN0eCA9IGF3YWl0IHNpbXVsYXRvci5yZW5kZXIoJy8nKTtcbiAgICBleHBlY3QoY3R4LnJlbmRlcmVkKS50b0JlVHJ1dGh5KCk7XG4gICAgZXhwZWN0KGN0eC5lbGVtZW50KS50b0JlVHJ1dGh5KCk7XG4gICAgZXhwZWN0KHJvb3QuZmlyc3RDaGlsZCkudG9CZVRydXRoeSgpO1xuICAgIGNvbnN0IGZpcnN0Q2hpbGQgPSAoKHJvb3QuZmlyc3RDaGlsZDogYW55KTogTm9kZSk7XG4gICAgZXhwZWN0KGZpcnN0Q2hpbGQubm9kZU5hbWUpLnRvQmUoJ1NQQU4nKTtcbiAgICBleHBlY3QoZmlyc3RDaGlsZC50ZXh0Q29udGVudCkudG9CZSgnaGVsbG8nKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGV4cGVjdChlKS50b0JlRmFsc3koKTtcbiAgfSBmaW5hbGx5IHtcbiAgICBjbGVhbnVwKHJvb3QpO1xuICAgIGRvbmUoKTtcbiAgfVxufSk7XG5cbmZ1bmN0aW9uIHNldHVwKCkge1xuICBjb25zdCByb290ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHJvb3QuaWQgPSAncm9vdCc7XG4gIGRvY3VtZW50LmJvZHkgJiYgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChyb290KTtcbiAgcmV0dXJuIHJvb3Q7XG59XG5cbmZ1bmN0aW9uIGNsZWFudXAocm9vdCkge1xuICBkb2N1bWVudC5ib2R5ICYmIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQocm9vdCk7XG59XG4iXX0=