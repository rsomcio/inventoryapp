import ServerAppFactory from '../server-app';
import { createPlugin } from '../create-plugin';
const App = false ? ClientAppFactory() : ServerAppFactory();
test('app.cleanup with no cleanup plugins', async () => {
  const app = new App('el', el => el);
  app.register(createPlugin({
    provides: () => 'hello world',
    middleware: () => (ctx, next) => next()
  }));
  app.resolve();
  await app.cleanup();
  expect('cleans up ok').toBeTruthy();
});
test('app.cleanup with async cleanup plugins', async () => {
  const app = new App('el', el => el);
  let firstCleanupCalled = false;
  let nextCleanupCalled = false;
  app.register(createPlugin({
    provides: () => 'hello world',
    cleanup: p => {
      firstCleanupCalled = true;
      expect(p).toBe('hello world');
      return Promise.resolve();
    },
    middleware: () => (ctx, next) => next()
  }));
  app.register(createPlugin({
    provides: () => 'another test',
    cleanup: p => {
      nextCleanupCalled = true;
      expect(p).toBe('another test');
      return Promise.resolve();
    },
    middleware: () => (ctx, next) => next()
  }));
  app.resolve();
  expect(firstCleanupCalled).toBeFalsy();
  expect(nextCleanupCalled).toBeFalsy();
  await app.cleanup();
  expect(firstCleanupCalled).toBeTruthy();
  expect(nextCleanupCalled).toBeTruthy();
});
test('app.cleanup does not cleanup if cleanup was not given a function', async () => {
  const app = new App('el', el => el);
  app.register(createPlugin({
    provides: () => 'hello world',
    // @ts-expect-error - Ignore this to test branch
    cleanup: 'notafunc',
    middleware: () => (ctx, next) => next()
  }));
  app.resolve();
  await app.cleanup();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJTZXJ2ZXJBcHBGYWN0b3J5IiwiY3JlYXRlUGx1Z2luIiwiQXBwIiwiQ2xpZW50QXBwRmFjdG9yeSIsInRlc3QiLCJhcHAiLCJlbCIsInJlZ2lzdGVyIiwicHJvdmlkZXMiLCJtaWRkbGV3YXJlIiwiY3R4IiwibmV4dCIsInJlc29sdmUiLCJjbGVhbnVwIiwiZXhwZWN0IiwidG9CZVRydXRoeSIsImZpcnN0Q2xlYW51cENhbGxlZCIsIm5leHRDbGVhbnVwQ2FsbGVkIiwicCIsInRvQmUiLCJQcm9taXNlIiwidG9CZUZhbHN5Il0sInNvdXJjZXMiOlsic3JjL19fdGVzdHNfXy9jbGVhbnVwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDbGllbnRBcHBGYWN0b3J5IGZyb20gJy4uL2NsaWVudC1hcHAnO1xuaW1wb3J0IFNlcnZlckFwcEZhY3RvcnkgZnJvbSAnLi4vc2VydmVyLWFwcCc7XG5pbXBvcnQge2NyZWF0ZVBsdWdpbn0gZnJvbSAnLi4vY3JlYXRlLXBsdWdpbic7XG5cbmNvbnN0IEFwcCA9IF9fQlJPV1NFUl9fID8gQ2xpZW50QXBwRmFjdG9yeSgpIDogU2VydmVyQXBwRmFjdG9yeSgpO1xuXG50ZXN0KCdhcHAuY2xlYW51cCB3aXRoIG5vIGNsZWFudXAgcGx1Z2lucycsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgYXBwID0gbmV3IEFwcCgnZWwnLCAoZWwpID0+IGVsKTtcbiAgYXBwLnJlZ2lzdGVyKFxuICAgIGNyZWF0ZVBsdWdpbih7XG4gICAgICBwcm92aWRlczogKCkgPT4gJ2hlbGxvIHdvcmxkJyxcbiAgICAgIG1pZGRsZXdhcmU6ICgpID0+IChjdHgsIG5leHQpID0+IG5leHQoKSxcbiAgICB9KVxuICApO1xuICBhcHAucmVzb2x2ZSgpO1xuICBhd2FpdCBhcHAuY2xlYW51cCgpO1xuICBleHBlY3QoJ2NsZWFucyB1cCBvaycpLnRvQmVUcnV0aHkoKTtcbn0pO1xuXG50ZXN0KCdhcHAuY2xlYW51cCB3aXRoIGFzeW5jIGNsZWFudXAgcGx1Z2lucycsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgYXBwID0gbmV3IEFwcCgnZWwnLCAoZWwpID0+IGVsKTtcbiAgbGV0IGZpcnN0Q2xlYW51cENhbGxlZCA9IGZhbHNlO1xuICBsZXQgbmV4dENsZWFudXBDYWxsZWQgPSBmYWxzZTtcbiAgYXBwLnJlZ2lzdGVyKFxuICAgIGNyZWF0ZVBsdWdpbih7XG4gICAgICBwcm92aWRlczogKCkgPT4gJ2hlbGxvIHdvcmxkJyxcbiAgICAgIGNsZWFudXA6IChwKSA9PiB7XG4gICAgICAgIGZpcnN0Q2xlYW51cENhbGxlZCA9IHRydWU7XG4gICAgICAgIGV4cGVjdChwKS50b0JlKCdoZWxsbyB3b3JsZCcpO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICB9LFxuICAgICAgbWlkZGxld2FyZTogKCkgPT4gKGN0eCwgbmV4dCkgPT4gbmV4dCgpLFxuICAgIH0pXG4gICk7XG4gIGFwcC5yZWdpc3RlcihcbiAgICBjcmVhdGVQbHVnaW4oe1xuICAgICAgcHJvdmlkZXM6ICgpID0+ICdhbm90aGVyIHRlc3QnLFxuICAgICAgY2xlYW51cDogKHApID0+IHtcbiAgICAgICAgbmV4dENsZWFudXBDYWxsZWQgPSB0cnVlO1xuICAgICAgICBleHBlY3QocCkudG9CZSgnYW5vdGhlciB0ZXN0Jyk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgIH0sXG4gICAgICBtaWRkbGV3YXJlOiAoKSA9PiAoY3R4LCBuZXh0KSA9PiBuZXh0KCksXG4gICAgfSlcbiAgKTtcbiAgYXBwLnJlc29sdmUoKTtcbiAgZXhwZWN0KGZpcnN0Q2xlYW51cENhbGxlZCkudG9CZUZhbHN5KCk7XG4gIGV4cGVjdChuZXh0Q2xlYW51cENhbGxlZCkudG9CZUZhbHN5KCk7XG4gIGF3YWl0IGFwcC5jbGVhbnVwKCk7XG4gIGV4cGVjdChmaXJzdENsZWFudXBDYWxsZWQpLnRvQmVUcnV0aHkoKTtcbiAgZXhwZWN0KG5leHRDbGVhbnVwQ2FsbGVkKS50b0JlVHJ1dGh5KCk7XG59KTtcblxudGVzdCgnYXBwLmNsZWFudXAgZG9lcyBub3QgY2xlYW51cCBpZiBjbGVhbnVwIHdhcyBub3QgZ2l2ZW4gYSBmdW5jdGlvbicsIGFzeW5jICgpID0+IHtcbiAgY29uc3QgYXBwID0gbmV3IEFwcCgnZWwnLCAoZWwpID0+IGVsKTtcbiAgYXBwLnJlZ2lzdGVyKFxuICAgIGNyZWF0ZVBsdWdpbih7XG4gICAgICBwcm92aWRlczogKCkgPT4gJ2hlbGxvIHdvcmxkJyxcbiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgLSBJZ25vcmUgdGhpcyB0byB0ZXN0IGJyYW5jaFxuICAgICAgY2xlYW51cDogJ25vdGFmdW5jJyxcbiAgICAgIG1pZGRsZXdhcmU6ICgpID0+IChjdHgsIG5leHQpID0+IG5leHQoKSxcbiAgICB9KVxuICApO1xuICBhcHAucmVzb2x2ZSgpO1xuICBhd2FpdCBhcHAuY2xlYW51cCgpO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUNBLE9BQU9BLGdCQUFnQixNQUFNLGVBQWU7QUFDNUMsU0FBUUMsWUFBWSxRQUFPLGtCQUFrQjtBQUU3QyxNQUFNQyxHQUFHLEdBQUcsUUFBY0MsZ0JBQWdCLEVBQUUsR0FBR0gsZ0JBQWdCLEVBQUU7QUFFakVJLElBQUksQ0FBQyxxQ0FBcUMsRUFBRSxZQUFZO0VBQ3RELE1BQU1DLEdBQUcsR0FBRyxJQUFJSCxHQUFHLENBQUMsSUFBSSxFQUFHSSxFQUFFLElBQUtBLEVBQUUsQ0FBQztFQUNyQ0QsR0FBRyxDQUFDRSxRQUFRLENBQ1ZOLFlBQVksQ0FBQztJQUNYTyxRQUFRLEVBQUUsTUFBTSxhQUFhO0lBQzdCQyxVQUFVLEVBQUUsTUFBTSxDQUFDQyxHQUFHLEVBQUVDLElBQUksS0FBS0EsSUFBSTtFQUN2QyxDQUFDLENBQUMsQ0FDSDtFQUNETixHQUFHLENBQUNPLE9BQU8sRUFBRTtFQUNiLE1BQU1QLEdBQUcsQ0FBQ1EsT0FBTyxFQUFFO0VBQ25CQyxNQUFNLENBQUMsY0FBYyxDQUFDLENBQUNDLFVBQVUsRUFBRTtBQUNyQyxDQUFDLENBQUM7QUFFRlgsSUFBSSxDQUFDLHdDQUF3QyxFQUFFLFlBQVk7RUFDekQsTUFBTUMsR0FBRyxHQUFHLElBQUlILEdBQUcsQ0FBQyxJQUFJLEVBQUdJLEVBQUUsSUFBS0EsRUFBRSxDQUFDO0VBQ3JDLElBQUlVLGtCQUFrQixHQUFHLEtBQUs7RUFDOUIsSUFBSUMsaUJBQWlCLEdBQUcsS0FBSztFQUM3QlosR0FBRyxDQUFDRSxRQUFRLENBQ1ZOLFlBQVksQ0FBQztJQUNYTyxRQUFRLEVBQUUsTUFBTSxhQUFhO0lBQzdCSyxPQUFPLEVBQUdLLENBQUMsSUFBSztNQUNkRixrQkFBa0IsR0FBRyxJQUFJO01BQ3pCRixNQUFNLENBQUNJLENBQUMsQ0FBQyxDQUFDQyxJQUFJLENBQUMsYUFBYSxDQUFDO01BQzdCLE9BQU9DLE9BQU8sQ0FBQ1IsT0FBTyxFQUFFO0lBQzFCLENBQUM7SUFDREgsVUFBVSxFQUFFLE1BQU0sQ0FBQ0MsR0FBRyxFQUFFQyxJQUFJLEtBQUtBLElBQUk7RUFDdkMsQ0FBQyxDQUFDLENBQ0g7RUFDRE4sR0FBRyxDQUFDRSxRQUFRLENBQ1ZOLFlBQVksQ0FBQztJQUNYTyxRQUFRLEVBQUUsTUFBTSxjQUFjO0lBQzlCSyxPQUFPLEVBQUdLLENBQUMsSUFBSztNQUNkRCxpQkFBaUIsR0FBRyxJQUFJO01BQ3hCSCxNQUFNLENBQUNJLENBQUMsQ0FBQyxDQUFDQyxJQUFJLENBQUMsY0FBYyxDQUFDO01BQzlCLE9BQU9DLE9BQU8sQ0FBQ1IsT0FBTyxFQUFFO0lBQzFCLENBQUM7SUFDREgsVUFBVSxFQUFFLE1BQU0sQ0FBQ0MsR0FBRyxFQUFFQyxJQUFJLEtBQUtBLElBQUk7RUFDdkMsQ0FBQyxDQUFDLENBQ0g7RUFDRE4sR0FBRyxDQUFDTyxPQUFPLEVBQUU7RUFDYkUsTUFBTSxDQUFDRSxrQkFBa0IsQ0FBQyxDQUFDSyxTQUFTLEVBQUU7RUFDdENQLE1BQU0sQ0FBQ0csaUJBQWlCLENBQUMsQ0FBQ0ksU0FBUyxFQUFFO0VBQ3JDLE1BQU1oQixHQUFHLENBQUNRLE9BQU8sRUFBRTtFQUNuQkMsTUFBTSxDQUFDRSxrQkFBa0IsQ0FBQyxDQUFDRCxVQUFVLEVBQUU7RUFDdkNELE1BQU0sQ0FBQ0csaUJBQWlCLENBQUMsQ0FBQ0YsVUFBVSxFQUFFO0FBQ3hDLENBQUMsQ0FBQztBQUVGWCxJQUFJLENBQUMsa0VBQWtFLEVBQUUsWUFBWTtFQUNuRixNQUFNQyxHQUFHLEdBQUcsSUFBSUgsR0FBRyxDQUFDLElBQUksRUFBR0ksRUFBRSxJQUFLQSxFQUFFLENBQUM7RUFDckNELEdBQUcsQ0FBQ0UsUUFBUSxDQUNWTixZQUFZLENBQUM7SUFDWE8sUUFBUSxFQUFFLE1BQU0sYUFBYTtJQUM3QjtJQUNBSyxPQUFPLEVBQUUsVUFBVTtJQUNuQkosVUFBVSxFQUFFLE1BQU0sQ0FBQ0MsR0FBRyxFQUFFQyxJQUFJLEtBQUtBLElBQUk7RUFDdkMsQ0FBQyxDQUFDLENBQ0g7RUFDRE4sR0FBRyxDQUFDTyxPQUFPLEVBQUU7RUFDYixNQUFNUCxHQUFHLENBQUNRLE9BQU8sRUFBRTtBQUNyQixDQUFDLENBQUMifQ==