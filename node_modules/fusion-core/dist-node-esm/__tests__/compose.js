/** Copyright (c) 2018 Uber Technologies, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

import { compose } from '../compose';
test('composed middleware are executed correctly', () => {
  function A(ctx, next) {
    return next();
  }
  const middleware = compose([A]);
  const next = () => Promise.resolve();
  // @ts-expect-error
  expect(() => middleware({}, next)).not.toThrow();
  expect(() => middleware(void 0, next)).not.toThrow();
  // @ts-expect-error
  expect(() => middleware()).not.toThrow();
});
test('downstream and upstream run in same order as koa', done => {
  expect.assertions(6);
  function a(ctx, next) {
    expect(++ctx.number).toBe(1);
    return next().then(() => {
      expect(++ctx.number).toBe(6);
    });
  }
  function b(ctx, next) {
    expect(++ctx.number).toBe(2);
    return next().then(() => {
      expect(++ctx.number).toBe(5);
    });
  }
  function c(ctx, next) {
    expect(++ctx.number).toBe(3);
    return next().then(() => {
      expect(++ctx.number).toBe(4);
    });
  }
  const middleware = compose([a, b, c]);
  const ctx = {
    number: 0
  };
  const next = () => Promise.resolve();
  // @ts-expect-error
  middleware(ctx, next).then(done);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb21wb3NlIiwidGVzdCIsIkEiLCJjdHgiLCJuZXh0IiwibWlkZGxld2FyZSIsIlByb21pc2UiLCJyZXNvbHZlIiwiZXhwZWN0Iiwibm90IiwidG9UaHJvdyIsImRvbmUiLCJhc3NlcnRpb25zIiwiYSIsIm51bWJlciIsInRvQmUiLCJ0aGVuIiwiYiIsImMiXSwic291cmNlcyI6WyJzcmMvX190ZXN0c19fL2NvbXBvc2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqIENvcHlyaWdodCAoYykgMjAxOCBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqL1xuXG5pbXBvcnQge2NvbXBvc2V9IGZyb20gJy4uL2NvbXBvc2UnO1xuXG50ZXN0KCdjb21wb3NlZCBtaWRkbGV3YXJlIGFyZSBleGVjdXRlZCBjb3JyZWN0bHknLCAoKSA9PiB7XG4gIGZ1bmN0aW9uIEEoY3R4LCBuZXh0KSB7XG4gICAgcmV0dXJuIG5leHQoKTtcbiAgfVxuICBjb25zdCBtaWRkbGV3YXJlID0gY29tcG9zZShbQV0pO1xuICBjb25zdCBuZXh0ID0gKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIC8vIEB0cy1leHBlY3QtZXJyb3JcbiAgZXhwZWN0KCgpID0+IG1pZGRsZXdhcmUoe30sIG5leHQpKS5ub3QudG9UaHJvdygpO1xuICBleHBlY3QoKCkgPT4gbWlkZGxld2FyZSh2b2lkIDAsIG5leHQpKS5ub3QudG9UaHJvdygpO1xuICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gIGV4cGVjdCgoKSA9PiBtaWRkbGV3YXJlKCkpLm5vdC50b1Rocm93KCk7XG59KTtcblxudGVzdCgnZG93bnN0cmVhbSBhbmQgdXBzdHJlYW0gcnVuIGluIHNhbWUgb3JkZXIgYXMga29hJywgKGRvbmUpID0+IHtcbiAgZXhwZWN0LmFzc2VydGlvbnMoNik7XG4gIGZ1bmN0aW9uIGEoY3R4LCBuZXh0KSB7XG4gICAgZXhwZWN0KCsrY3R4Lm51bWJlcikudG9CZSgxKTtcbiAgICByZXR1cm4gbmV4dCgpLnRoZW4oKCkgPT4ge1xuICAgICAgZXhwZWN0KCsrY3R4Lm51bWJlcikudG9CZSg2KTtcbiAgICB9KTtcbiAgfVxuICBmdW5jdGlvbiBiKGN0eCwgbmV4dCkge1xuICAgIGV4cGVjdCgrK2N0eC5udW1iZXIpLnRvQmUoMik7XG4gICAgcmV0dXJuIG5leHQoKS50aGVuKCgpID0+IHtcbiAgICAgIGV4cGVjdCgrK2N0eC5udW1iZXIpLnRvQmUoNSk7XG4gICAgfSk7XG4gIH1cbiAgZnVuY3Rpb24gYyhjdHgsIG5leHQpIHtcbiAgICBleHBlY3QoKytjdHgubnVtYmVyKS50b0JlKDMpO1xuICAgIHJldHVybiBuZXh0KCkudGhlbigoKSA9PiB7XG4gICAgICBleHBlY3QoKytjdHgubnVtYmVyKS50b0JlKDQpO1xuICAgIH0pO1xuICB9XG4gIGNvbnN0IG1pZGRsZXdhcmUgPSBjb21wb3NlKFthLCBiLCBjXSk7XG4gIGNvbnN0IGN0eCA9IHtudW1iZXI6IDB9O1xuICBjb25zdCBuZXh0ID0gKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIC8vIEB0cy1leHBlY3QtZXJyb3JcbiAgbWlkZGxld2FyZShjdHgsIG5leHQpLnRoZW4oZG9uZSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLFNBQVFBLE9BQU8sUUFBTyxZQUFZO0FBRWxDQyxJQUFJLENBQUMsNENBQTRDLEVBQUUsTUFBTTtFQUN2RCxTQUFTQyxDQUFDLENBQUNDLEdBQUcsRUFBRUMsSUFBSSxFQUFFO0lBQ3BCLE9BQU9BLElBQUksRUFBRTtFQUNmO0VBQ0EsTUFBTUMsVUFBVSxHQUFHTCxPQUFPLENBQUMsQ0FBQ0UsQ0FBQyxDQUFDLENBQUM7RUFDL0IsTUFBTUUsSUFBSSxHQUFHLE1BQU1FLE9BQU8sQ0FBQ0MsT0FBTyxFQUFFO0VBQ3BDO0VBQ0FDLE1BQU0sQ0FBQyxNQUFNSCxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQUVELElBQUksQ0FBQyxDQUFDLENBQUNLLEdBQUcsQ0FBQ0MsT0FBTyxFQUFFO0VBQ2hERixNQUFNLENBQUMsTUFBTUgsVUFBVSxDQUFDLEtBQUssQ0FBQyxFQUFFRCxJQUFJLENBQUMsQ0FBQyxDQUFDSyxHQUFHLENBQUNDLE9BQU8sRUFBRTtFQUNwRDtFQUNBRixNQUFNLENBQUMsTUFBTUgsVUFBVSxFQUFFLENBQUMsQ0FBQ0ksR0FBRyxDQUFDQyxPQUFPLEVBQUU7QUFDMUMsQ0FBQyxDQUFDO0FBRUZULElBQUksQ0FBQyxrREFBa0QsRUFBR1UsSUFBSSxJQUFLO0VBQ2pFSCxNQUFNLENBQUNJLFVBQVUsQ0FBQyxDQUFDLENBQUM7RUFDcEIsU0FBU0MsQ0FBQyxDQUFDVixHQUFHLEVBQUVDLElBQUksRUFBRTtJQUNwQkksTUFBTSxDQUFDLEVBQUVMLEdBQUcsQ0FBQ1csTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDNUIsT0FBT1gsSUFBSSxFQUFFLENBQUNZLElBQUksQ0FBQyxNQUFNO01BQ3ZCUixNQUFNLENBQUMsRUFBRUwsR0FBRyxDQUFDVyxNQUFNLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUM5QixDQUFDLENBQUM7RUFDSjtFQUNBLFNBQVNFLENBQUMsQ0FBQ2QsR0FBRyxFQUFFQyxJQUFJLEVBQUU7SUFDcEJJLE1BQU0sQ0FBQyxFQUFFTCxHQUFHLENBQUNXLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQzVCLE9BQU9YLElBQUksRUFBRSxDQUFDWSxJQUFJLENBQUMsTUFBTTtNQUN2QlIsTUFBTSxDQUFDLEVBQUVMLEdBQUcsQ0FBQ1csTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDOUIsQ0FBQyxDQUFDO0VBQ0o7RUFDQSxTQUFTRyxDQUFDLENBQUNmLEdBQUcsRUFBRUMsSUFBSSxFQUFFO0lBQ3BCSSxNQUFNLENBQUMsRUFBRUwsR0FBRyxDQUFDVyxNQUFNLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUM1QixPQUFPWCxJQUFJLEVBQUUsQ0FBQ1ksSUFBSSxDQUFDLE1BQU07TUFDdkJSLE1BQU0sQ0FBQyxFQUFFTCxHQUFHLENBQUNXLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQzlCLENBQUMsQ0FBQztFQUNKO0VBQ0EsTUFBTVYsVUFBVSxHQUFHTCxPQUFPLENBQUMsQ0FBQ2EsQ0FBQyxFQUFFSSxDQUFDLEVBQUVDLENBQUMsQ0FBQyxDQUFDO0VBQ3JDLE1BQU1mLEdBQUcsR0FBRztJQUFDVyxNQUFNLEVBQUU7RUFBQyxDQUFDO0VBQ3ZCLE1BQU1WLElBQUksR0FBRyxNQUFNRSxPQUFPLENBQUNDLE9BQU8sRUFBRTtFQUNwQztFQUNBRixVQUFVLENBQUNGLEdBQUcsRUFBRUMsSUFBSSxDQUFDLENBQUNZLElBQUksQ0FBQ0wsSUFBSSxDQUFDO0FBQ2xDLENBQUMsQ0FBQyJ9