/** Copyright (c) 2018 Uber Technologies, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

import { createPlugin } from '../create-plugin';
import { escape, consumeSanitizedHTML, html } from '../sanitization';
import { unstable_EnableServerStreamingToken } from '../tokens';
import { appSymbol } from '../utils/app-symbol';
import { isBot } from '../utils/is-bot';
const SSRDecider = createPlugin({
  deps: {
    enableServerStreaming: unstable_EnableServerStreamingToken.optional
  },
  provides: deps => {
    return ctx => {
      // If the request has one of these extensions, we assume it's not something that requires server-side rendering of virtual dom
      // TODO(#46): this check should probably look at the asset manifest to ensure asset 404s are handled correctly
      if (ctx.path.match(/\.(js|js\.map|gif|jpg|png|pdf|json|svg)$/)) return false;
      if (isBot(ctx)) {
        return true;
      }

      // The Accept header is a good proxy for whether SSR should happen
      // Requesting an HTML page via the browser url bar generates a request with `text/html` in its Accept headers
      // XHR/fetch requests do not have `text/html` in the Accept headers
      if (!ctx.headers.accept) return false;
      if (!ctx.headers.accept.includes('text/html')) return false;
      return deps.enableServerStreaming ? 'stream' : true;
    };
  }
});
export { SSRDecider };
export default function createSSRPlugin(endpoints) {
  return function ssrMiddleware({
    element,
    ssrDecider,
    ssrBodyTemplate,
    ssrShellTemplate
  }) {
    return async function ssrMiddleware(ctx, next) {
      if (endpoints.has(ctx.path)) {
        return next();
      }
      if (!ssrDecider(ctx)) return next();
      const template = {
        htmlAttrs: {},
        bodyAttrs: {},
        title: '',
        head: [],
        body: []
      };
      ctx.element = element;
      ctx.rendered = '';
      ctx.template = template;
      ctx.type = 'text/html';
      if (ssrShellTemplate) {
        ctx.shellTemplate = ssrShellTemplate;
      }

      // If streaming, add effects to prepare boundary once it drops
      if (ssrDecider(ctx) === 'stream') {
        // @ts-expect-error todo(flow->ts) TS2538: Type 'unique symbol' cannot be used as an index type.
        const app = ctx[appSymbol];
        // Reset in case it has been set
        app.prepareBoundary.reset();
        // Add boundary effect to run through all postPrepare effects once the
        // prepare boundary drops
        app.prepareBoundary.addEffect(() => {
          for (const effect of ctx.postPrepareEffects) {
            effect();
          }
        });
        // Add boundary effect to serialize any universalValues to head once the prepare
        // boundary drops
        app.prepareBoundary.addEffect(() => {
          ctx.template.head.push(getSerializedUniversalValues(ctx));
        });
      }
      await next();

      // Allow someone to override the ssr by setting ctx.body
      // This is especially useful for things like ctx.redirect
      if (ctx.body && ctx.respond !== false) {
        return;
      }
      ctx.template.head.push(getSerializedUniversalValues(ctx));
      if (ssrBodyTemplate) {
        ctx.body = ssrBodyTemplate(ctx);
      } else {
        ctx.body = legacySSRBodyTemplate(ctx);
      }
    };
  };
}
function legacySSRBodyTemplate(ctx) {
  const {
    htmlAttrs,
    bodyAttrs,
    title,
    head,
    body
  } = ctx.template;
  const safeAttrs = Object.keys(htmlAttrs).map(attrKey => {
    return ` ${escape(attrKey)}="${escape(htmlAttrs[attrKey])}"`;
  }).join('');
  const safeBodyAttrs = Object.keys(bodyAttrs).map(attrKey => {
    return ` ${escape(attrKey)}="${escape(bodyAttrs[attrKey])}"`;
  }).join('');
  const safeTitle = escape(title);
  const safeHead = head.map(consumeSanitizedHTML).join('');
  const safeBody = body.map(consumeSanitizedHTML).join('');
  const preloadHintLinks = getPreloadHintLinks(ctx);
  const coreGlobals = getCoreGlobals(ctx);
  const chunkScripts = getChunkScripts(ctx);
  const bundleSplittingBootstrap = [preloadHintLinks, coreGlobals, chunkScripts].join('');
  return ['<!doctype html>', `<html${safeAttrs}>`, `<head>`, `<meta charset="utf-8" />`, `<title>${safeTitle}</title>`, `${bundleSplittingBootstrap}${safeHead}`, `</head>`, `<body${safeBodyAttrs}>${ctx.rendered}${safeBody}</body>`, '</html>'].join('');
}
function getCoreGlobals(ctx) {
  const {
    webpackPublicPath,
    nonce
  } = ctx;
  return [`<script nonce="${nonce}">`, `window.performance && window.performance.mark && window.performance.mark('firstRenderStart');`, `__ROUTE_PREFIX__ = ${JSON.stringify(ctx.prefix)};`,
  // consumed by ./client
  `__WEBPACK_PUBLIC_PATH__ = ${JSON.stringify(webpackPublicPath)};`,
  // consumed by fusion-clientries/client-entry
  `</script>`].join('');
}
function getUrls({
  chunkUrlMap,
  webpackPublicPath
}, chunks) {
  // cross origin is needed to get meaningful errors in window.onerror
  const isCrossOrigin = webpackPublicPath.startsWith('http');
  const crossOriginAttribute = isCrossOrigin ? ' crossorigin="anonymous"' : '';
  return [...new Set(chunks)].map(id => {
    let url = chunkUrlMap.get(id).get('es5');
    if (webpackPublicPath.endsWith('/')) {
      url = webpackPublicPath + url;
    } else {
      url = webpackPublicPath + '/' + url;
    }
    return {
      url,
      crossOriginAttribute
    };
  });
}
function getChunkScripts(ctx) {
  const sync = getUrls(ctx, ctx.syncChunks).map(({
    url,
    crossOriginAttribute
  }) => {
    return `<script nonce="${ctx.nonce}" defer${crossOriginAttribute} src="${url}"></script>`;
  });
  const preloaded = getUrls(ctx, ctx.preloadChunks.filter(item => !ctx.syncChunks.includes(item))).map(({
    url,
    crossOriginAttribute
  }) => {
    return `<script nonce="${ctx.nonce}" defer${crossOriginAttribute} src="${url}"></script>`;
  });
  return [...preloaded, ...sync].join('');
}
function getPreloadHintLinks(ctx) {
  const chunks = [...ctx.preloadChunks, ...ctx.syncChunks];
  const hints = getUrls(ctx, chunks).map(({
    url,
    crossOriginAttribute
  }) => {
    return `<link rel="preload"${crossOriginAttribute} href="${url}" nonce="${ctx.nonce}" as="script" />`;
  });
  return hints.join('');
}
function getSerializedUniversalValues(ctx) {
  const app = ctx[appSymbol];
  return html`<script type="application/json" id="__FUSION_UNIVERSAL_VALUES__">
    ${JSON.stringify({
    ...app.universalValues,
    ...ctx.universalValues
  })}
  </script>`;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVQbHVnaW4iLCJlc2NhcGUiLCJjb25zdW1lU2FuaXRpemVkSFRNTCIsImh0bWwiLCJ1bnN0YWJsZV9FbmFibGVTZXJ2ZXJTdHJlYW1pbmdUb2tlbiIsImFwcFN5bWJvbCIsImlzQm90IiwiU1NSRGVjaWRlciIsImRlcHMiLCJlbmFibGVTZXJ2ZXJTdHJlYW1pbmciLCJvcHRpb25hbCIsInByb3ZpZGVzIiwiY3R4IiwicGF0aCIsIm1hdGNoIiwiaGVhZGVycyIsImFjY2VwdCIsImluY2x1ZGVzIiwiY3JlYXRlU1NSUGx1Z2luIiwiZW5kcG9pbnRzIiwic3NyTWlkZGxld2FyZSIsImVsZW1lbnQiLCJzc3JEZWNpZGVyIiwic3NyQm9keVRlbXBsYXRlIiwic3NyU2hlbGxUZW1wbGF0ZSIsIm5leHQiLCJoYXMiLCJ0ZW1wbGF0ZSIsImh0bWxBdHRycyIsImJvZHlBdHRycyIsInRpdGxlIiwiaGVhZCIsImJvZHkiLCJyZW5kZXJlZCIsInR5cGUiLCJzaGVsbFRlbXBsYXRlIiwiYXBwIiwicHJlcGFyZUJvdW5kYXJ5IiwicmVzZXQiLCJhZGRFZmZlY3QiLCJlZmZlY3QiLCJwb3N0UHJlcGFyZUVmZmVjdHMiLCJwdXNoIiwiZ2V0U2VyaWFsaXplZFVuaXZlcnNhbFZhbHVlcyIsInJlc3BvbmQiLCJsZWdhY3lTU1JCb2R5VGVtcGxhdGUiLCJzYWZlQXR0cnMiLCJPYmplY3QiLCJrZXlzIiwibWFwIiwiYXR0cktleSIsImpvaW4iLCJzYWZlQm9keUF0dHJzIiwic2FmZVRpdGxlIiwic2FmZUhlYWQiLCJzYWZlQm9keSIsInByZWxvYWRIaW50TGlua3MiLCJnZXRQcmVsb2FkSGludExpbmtzIiwiY29yZUdsb2JhbHMiLCJnZXRDb3JlR2xvYmFscyIsImNodW5rU2NyaXB0cyIsImdldENodW5rU2NyaXB0cyIsImJ1bmRsZVNwbGl0dGluZ0Jvb3RzdHJhcCIsIndlYnBhY2tQdWJsaWNQYXRoIiwibm9uY2UiLCJKU09OIiwic3RyaW5naWZ5IiwicHJlZml4IiwiZ2V0VXJscyIsImNodW5rVXJsTWFwIiwiY2h1bmtzIiwiaXNDcm9zc09yaWdpbiIsInN0YXJ0c1dpdGgiLCJjcm9zc09yaWdpbkF0dHJpYnV0ZSIsIlNldCIsImlkIiwidXJsIiwiZ2V0IiwiZW5kc1dpdGgiLCJzeW5jIiwic3luY0NodW5rcyIsInByZWxvYWRlZCIsInByZWxvYWRDaHVua3MiLCJmaWx0ZXIiLCJpdGVtIiwiaGludHMiLCJ1bml2ZXJzYWxWYWx1ZXMiXSwic291cmNlcyI6WyJzcmMvcGx1Z2lucy9zc3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqIENvcHlyaWdodCAoYykgMjAxOCBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqL1xuXG5pbXBvcnQge2NyZWF0ZVBsdWdpbn0gZnJvbSAnLi4vY3JlYXRlLXBsdWdpbic7XG5pbXBvcnQge2VzY2FwZSwgY29uc3VtZVNhbml0aXplZEhUTUwsIGh0bWx9IGZyb20gJy4uL3Nhbml0aXphdGlvbic7XG5pbXBvcnQge3Vuc3RhYmxlX0VuYWJsZVNlcnZlclN0cmVhbWluZ1Rva2VufSBmcm9tICcuLi90b2tlbnMnO1xuaW1wb3J0IHthcHBTeW1ib2x9IGZyb20gJy4uL3V0aWxzL2FwcC1zeW1ib2wnO1xuaW1wb3J0IHtpc0JvdH0gZnJvbSAnLi4vdXRpbHMvaXMtYm90JztcbmltcG9ydCB0eXBlIHtcbiAgQ29udGV4dCxcbiAgU1NSRGVjaWRlciBhcyBTU1JEZWNpZGVyU2VydmljZSxcbiAgU1NSQm9keVRlbXBsYXRlIGFzIFNTUkJvZHlUZW1wbGF0ZVNlcnZpY2UsXG59IGZyb20gJy4uL3R5cGVzJztcblxuY29uc3QgU1NSRGVjaWRlciA9IGNyZWF0ZVBsdWdpbih7XG4gIGRlcHM6IHtcbiAgICBlbmFibGVTZXJ2ZXJTdHJlYW1pbmc6IHVuc3RhYmxlX0VuYWJsZVNlcnZlclN0cmVhbWluZ1Rva2VuLm9wdGlvbmFsLFxuICB9LFxuICBwcm92aWRlczogKGRlcHMpOiBTU1JEZWNpZGVyU2VydmljZSA9PiB7XG4gICAgcmV0dXJuIChjdHgpID0+IHtcbiAgICAgIC8vIElmIHRoZSByZXF1ZXN0IGhhcyBvbmUgb2YgdGhlc2UgZXh0ZW5zaW9ucywgd2UgYXNzdW1lIGl0J3Mgbm90IHNvbWV0aGluZyB0aGF0IHJlcXVpcmVzIHNlcnZlci1zaWRlIHJlbmRlcmluZyBvZiB2aXJ0dWFsIGRvbVxuICAgICAgLy8gVE9ETygjNDYpOiB0aGlzIGNoZWNrIHNob3VsZCBwcm9iYWJseSBsb29rIGF0IHRoZSBhc3NldCBtYW5pZmVzdCB0byBlbnN1cmUgYXNzZXQgNDA0cyBhcmUgaGFuZGxlZCBjb3JyZWN0bHlcbiAgICAgIGlmIChjdHgucGF0aC5tYXRjaCgvXFwuKGpzfGpzXFwubWFwfGdpZnxqcGd8cG5nfHBkZnxqc29ufHN2ZykkLykpXG4gICAgICAgIHJldHVybiBmYWxzZTtcblxuICAgICAgaWYgKGlzQm90KGN0eCkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIC8vIFRoZSBBY2NlcHQgaGVhZGVyIGlzIGEgZ29vZCBwcm94eSBmb3Igd2hldGhlciBTU1Igc2hvdWxkIGhhcHBlblxuICAgICAgLy8gUmVxdWVzdGluZyBhbiBIVE1MIHBhZ2UgdmlhIHRoZSBicm93c2VyIHVybCBiYXIgZ2VuZXJhdGVzIGEgcmVxdWVzdCB3aXRoIGB0ZXh0L2h0bWxgIGluIGl0cyBBY2NlcHQgaGVhZGVyc1xuICAgICAgLy8gWEhSL2ZldGNoIHJlcXVlc3RzIGRvIG5vdCBoYXZlIGB0ZXh0L2h0bWxgIGluIHRoZSBBY2NlcHQgaGVhZGVyc1xuICAgICAgaWYgKCFjdHguaGVhZGVycy5hY2NlcHQpIHJldHVybiBmYWxzZTtcbiAgICAgIGlmICghY3R4LmhlYWRlcnMuYWNjZXB0LmluY2x1ZGVzKCd0ZXh0L2h0bWwnKSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICByZXR1cm4gZGVwcy5lbmFibGVTZXJ2ZXJTdHJlYW1pbmcgPyAnc3RyZWFtJyA6IHRydWU7XG4gICAgfTtcbiAgfSxcbn0pO1xuXG5leHBvcnQge1NTUkRlY2lkZXJ9O1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVTU1JQbHVnaW4oZW5kcG9pbnRzKSB7XG4gIHJldHVybiBmdW5jdGlvbiBzc3JNaWRkbGV3YXJlKHtcbiAgICBlbGVtZW50LFxuICAgIHNzckRlY2lkZXIsXG4gICAgc3NyQm9keVRlbXBsYXRlLFxuICAgIHNzclNoZWxsVGVtcGxhdGUsXG4gIH06IHtcbiAgICBlbGVtZW50OiBhbnk7XG4gICAgc3NyRGVjaWRlcjogU1NSRGVjaWRlclNlcnZpY2U7XG4gICAgc3NyQm9keVRlbXBsYXRlPzogU1NSQm9keVRlbXBsYXRlU2VydmljZTtcbiAgICBzc3JTaGVsbFRlbXBsYXRlOiBhbnk7XG4gIH0pIHtcbiAgICByZXR1cm4gYXN5bmMgZnVuY3Rpb24gc3NyTWlkZGxld2FyZShcbiAgICAgIGN0eDogQ29udGV4dCxcbiAgICAgIG5leHQ6ICgpID0+IFByb21pc2U8dm9pZD5cbiAgICApIHtcbiAgICAgIGlmIChlbmRwb2ludHMuaGFzKGN0eC5wYXRoKSkge1xuICAgICAgICByZXR1cm4gbmV4dCgpO1xuICAgICAgfVxuICAgICAgaWYgKCFzc3JEZWNpZGVyKGN0eCkpIHJldHVybiBuZXh0KCk7XG5cbiAgICAgIGNvbnN0IHRlbXBsYXRlID0ge1xuICAgICAgICBodG1sQXR0cnM6IHt9LFxuICAgICAgICBib2R5QXR0cnM6IHt9LFxuICAgICAgICB0aXRsZTogJycsXG4gICAgICAgIGhlYWQ6IFtdLFxuICAgICAgICBib2R5OiBbXSxcbiAgICAgIH07XG4gICAgICBjdHguZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICBjdHgucmVuZGVyZWQgPSAnJztcbiAgICAgIGN0eC50ZW1wbGF0ZSA9IHRlbXBsYXRlO1xuICAgICAgY3R4LnR5cGUgPSAndGV4dC9odG1sJztcbiAgICAgIGlmIChzc3JTaGVsbFRlbXBsYXRlKSB7XG4gICAgICAgIGN0eC5zaGVsbFRlbXBsYXRlID0gc3NyU2hlbGxUZW1wbGF0ZTtcbiAgICAgIH1cblxuICAgICAgLy8gSWYgc3RyZWFtaW5nLCBhZGQgZWZmZWN0cyB0byBwcmVwYXJlIGJvdW5kYXJ5IG9uY2UgaXQgZHJvcHNcbiAgICAgIGlmIChzc3JEZWNpZGVyKGN0eCkgPT09ICdzdHJlYW0nKSB7XG4gICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgdG9kbyhmbG93LT50cykgVFMyNTM4OiBUeXBlICd1bmlxdWUgc3ltYm9sJyBjYW5ub3QgYmUgdXNlZCBhcyBhbiBpbmRleCB0eXBlLlxuICAgICAgICBjb25zdCBhcHAgPSBjdHhbYXBwU3ltYm9sXTtcbiAgICAgICAgLy8gUmVzZXQgaW4gY2FzZSBpdCBoYXMgYmVlbiBzZXRcbiAgICAgICAgYXBwLnByZXBhcmVCb3VuZGFyeS5yZXNldCgpO1xuICAgICAgICAvLyBBZGQgYm91bmRhcnkgZWZmZWN0IHRvIHJ1biB0aHJvdWdoIGFsbCBwb3N0UHJlcGFyZSBlZmZlY3RzIG9uY2UgdGhlXG4gICAgICAgIC8vIHByZXBhcmUgYm91bmRhcnkgZHJvcHNcbiAgICAgICAgYXBwLnByZXBhcmVCb3VuZGFyeS5hZGRFZmZlY3QoKCkgPT4ge1xuICAgICAgICAgIGZvciAoY29uc3QgZWZmZWN0IG9mIGN0eC5wb3N0UHJlcGFyZUVmZmVjdHMpIHtcbiAgICAgICAgICAgIGVmZmVjdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIEFkZCBib3VuZGFyeSBlZmZlY3QgdG8gc2VyaWFsaXplIGFueSB1bml2ZXJzYWxWYWx1ZXMgdG8gaGVhZCBvbmNlIHRoZSBwcmVwYXJlXG4gICAgICAgIC8vIGJvdW5kYXJ5IGRyb3BzXG4gICAgICAgIGFwcC5wcmVwYXJlQm91bmRhcnkuYWRkRWZmZWN0KCgpID0+IHtcbiAgICAgICAgICBjdHgudGVtcGxhdGUuaGVhZC5wdXNoKGdldFNlcmlhbGl6ZWRVbml2ZXJzYWxWYWx1ZXMoY3R4KSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBhd2FpdCBuZXh0KCk7XG5cbiAgICAgIC8vIEFsbG93IHNvbWVvbmUgdG8gb3ZlcnJpZGUgdGhlIHNzciBieSBzZXR0aW5nIGN0eC5ib2R5XG4gICAgICAvLyBUaGlzIGlzIGVzcGVjaWFsbHkgdXNlZnVsIGZvciB0aGluZ3MgbGlrZSBjdHgucmVkaXJlY3RcbiAgICAgIGlmIChjdHguYm9keSAmJiBjdHgucmVzcG9uZCAhPT0gZmFsc2UpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjdHgudGVtcGxhdGUuaGVhZC5wdXNoKGdldFNlcmlhbGl6ZWRVbml2ZXJzYWxWYWx1ZXMoY3R4KSk7XG5cbiAgICAgIGlmIChzc3JCb2R5VGVtcGxhdGUpIHtcbiAgICAgICAgY3R4LmJvZHkgPSBzc3JCb2R5VGVtcGxhdGUoY3R4KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGN0eC5ib2R5ID0gbGVnYWN5U1NSQm9keVRlbXBsYXRlKGN0eCk7XG4gICAgICB9XG4gICAgfTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gbGVnYWN5U1NSQm9keVRlbXBsYXRlKGN0eCkge1xuICBjb25zdCB7aHRtbEF0dHJzLCBib2R5QXR0cnMsIHRpdGxlLCBoZWFkLCBib2R5fSA9IGN0eC50ZW1wbGF0ZTtcbiAgY29uc3Qgc2FmZUF0dHJzID0gT2JqZWN0LmtleXMoaHRtbEF0dHJzKVxuICAgIC5tYXAoKGF0dHJLZXkpID0+IHtcbiAgICAgIHJldHVybiBgICR7ZXNjYXBlKGF0dHJLZXkpfT1cIiR7ZXNjYXBlKGh0bWxBdHRyc1thdHRyS2V5XSl9XCJgO1xuICAgIH0pXG4gICAgLmpvaW4oJycpO1xuXG4gIGNvbnN0IHNhZmVCb2R5QXR0cnMgPSBPYmplY3Qua2V5cyhib2R5QXR0cnMpXG4gICAgLm1hcCgoYXR0cktleSkgPT4ge1xuICAgICAgcmV0dXJuIGAgJHtlc2NhcGUoYXR0cktleSl9PVwiJHtlc2NhcGUoYm9keUF0dHJzW2F0dHJLZXldKX1cImA7XG4gICAgfSlcbiAgICAuam9pbignJyk7XG5cbiAgY29uc3Qgc2FmZVRpdGxlID0gZXNjYXBlKHRpdGxlKTtcbiAgY29uc3Qgc2FmZUhlYWQgPSBoZWFkLm1hcChjb25zdW1lU2FuaXRpemVkSFRNTCkuam9pbignJyk7XG4gIGNvbnN0IHNhZmVCb2R5ID0gYm9keS5tYXAoY29uc3VtZVNhbml0aXplZEhUTUwpLmpvaW4oJycpO1xuXG4gIGNvbnN0IHByZWxvYWRIaW50TGlua3MgPSBnZXRQcmVsb2FkSGludExpbmtzKGN0eCk7XG4gIGNvbnN0IGNvcmVHbG9iYWxzID0gZ2V0Q29yZUdsb2JhbHMoY3R4KTtcbiAgY29uc3QgY2h1bmtTY3JpcHRzID0gZ2V0Q2h1bmtTY3JpcHRzKGN0eCk7XG4gIGNvbnN0IGJ1bmRsZVNwbGl0dGluZ0Jvb3RzdHJhcCA9IFtcbiAgICBwcmVsb2FkSGludExpbmtzLFxuICAgIGNvcmVHbG9iYWxzLFxuICAgIGNodW5rU2NyaXB0cyxcbiAgXS5qb2luKCcnKTtcblxuICByZXR1cm4gW1xuICAgICc8IWRvY3R5cGUgaHRtbD4nLFxuICAgIGA8aHRtbCR7c2FmZUF0dHJzfT5gLFxuICAgIGA8aGVhZD5gLFxuICAgIGA8bWV0YSBjaGFyc2V0PVwidXRmLThcIiAvPmAsXG4gICAgYDx0aXRsZT4ke3NhZmVUaXRsZX08L3RpdGxlPmAsXG4gICAgYCR7YnVuZGxlU3BsaXR0aW5nQm9vdHN0cmFwfSR7c2FmZUhlYWR9YCxcbiAgICBgPC9oZWFkPmAsXG4gICAgYDxib2R5JHtzYWZlQm9keUF0dHJzfT4ke2N0eC5yZW5kZXJlZH0ke3NhZmVCb2R5fTwvYm9keT5gLFxuICAgICc8L2h0bWw+JyxcbiAgXS5qb2luKCcnKTtcbn1cblxuZnVuY3Rpb24gZ2V0Q29yZUdsb2JhbHMoY3R4KSB7XG4gIGNvbnN0IHt3ZWJwYWNrUHVibGljUGF0aCwgbm9uY2V9ID0gY3R4O1xuXG4gIHJldHVybiBbXG4gICAgYDxzY3JpcHQgbm9uY2U9XCIke25vbmNlfVwiPmAsXG4gICAgYHdpbmRvdy5wZXJmb3JtYW5jZSAmJiB3aW5kb3cucGVyZm9ybWFuY2UubWFyayAmJiB3aW5kb3cucGVyZm9ybWFuY2UubWFyaygnZmlyc3RSZW5kZXJTdGFydCcpO2AsXG4gICAgYF9fUk9VVEVfUFJFRklYX18gPSAke0pTT04uc3RyaW5naWZ5KGN0eC5wcmVmaXgpfTtgLCAvLyBjb25zdW1lZCBieSAuL2NsaWVudFxuICAgIGBfX1dFQlBBQ0tfUFVCTElDX1BBVEhfXyA9ICR7SlNPTi5zdHJpbmdpZnkod2VicGFja1B1YmxpY1BhdGgpfTtgLCAvLyBjb25zdW1lZCBieSBmdXNpb24tY2xpZW50cmllcy9jbGllbnQtZW50cnlcbiAgICBgPC9zY3JpcHQ+YCxcbiAgXS5qb2luKCcnKTtcbn1cblxuZnVuY3Rpb24gZ2V0VXJscyh7Y2h1bmtVcmxNYXAsIHdlYnBhY2tQdWJsaWNQYXRofSwgY2h1bmtzKSB7XG4gIC8vIGNyb3NzIG9yaWdpbiBpcyBuZWVkZWQgdG8gZ2V0IG1lYW5pbmdmdWwgZXJyb3JzIGluIHdpbmRvdy5vbmVycm9yXG4gIGNvbnN0IGlzQ3Jvc3NPcmlnaW4gPSB3ZWJwYWNrUHVibGljUGF0aC5zdGFydHNXaXRoKCdodHRwJyk7XG4gIGNvbnN0IGNyb3NzT3JpZ2luQXR0cmlidXRlID0gaXNDcm9zc09yaWdpbiA/ICcgY3Jvc3NvcmlnaW49XCJhbm9ueW1vdXNcIicgOiAnJztcbiAgcmV0dXJuIFsuLi5uZXcgU2V0KGNodW5rcyldLm1hcCgoaWQpID0+IHtcbiAgICBsZXQgdXJsID0gY2h1bmtVcmxNYXAuZ2V0KGlkKS5nZXQoJ2VzNScpO1xuICAgIGlmICh3ZWJwYWNrUHVibGljUGF0aC5lbmRzV2l0aCgnLycpKSB7XG4gICAgICB1cmwgPSB3ZWJwYWNrUHVibGljUGF0aCArIHVybDtcbiAgICB9IGVsc2Uge1xuICAgICAgdXJsID0gd2VicGFja1B1YmxpY1BhdGggKyAnLycgKyB1cmw7XG4gICAgfVxuICAgIHJldHVybiB7dXJsLCBjcm9zc09yaWdpbkF0dHJpYnV0ZX07XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBnZXRDaHVua1NjcmlwdHMoY3R4KSB7XG4gIGNvbnN0IHN5bmMgPSBnZXRVcmxzKGN0eCwgY3R4LnN5bmNDaHVua3MpLm1hcChcbiAgICAoe3VybCwgY3Jvc3NPcmlnaW5BdHRyaWJ1dGV9KSA9PiB7XG4gICAgICByZXR1cm4gYDxzY3JpcHQgbm9uY2U9XCIke2N0eC5ub25jZX1cIiBkZWZlciR7Y3Jvc3NPcmlnaW5BdHRyaWJ1dGV9IHNyYz1cIiR7dXJsfVwiPjwvc2NyaXB0PmA7XG4gICAgfVxuICApO1xuICBjb25zdCBwcmVsb2FkZWQgPSBnZXRVcmxzKFxuICAgIGN0eCxcbiAgICBjdHgucHJlbG9hZENodW5rcy5maWx0ZXIoKGl0ZW0pID0+ICFjdHguc3luY0NodW5rcy5pbmNsdWRlcyhpdGVtKSlcbiAgKS5tYXAoKHt1cmwsIGNyb3NzT3JpZ2luQXR0cmlidXRlfSkgPT4ge1xuICAgIHJldHVybiBgPHNjcmlwdCBub25jZT1cIiR7Y3R4Lm5vbmNlfVwiIGRlZmVyJHtjcm9zc09yaWdpbkF0dHJpYnV0ZX0gc3JjPVwiJHt1cmx9XCI+PC9zY3JpcHQ+YDtcbiAgfSk7XG4gIHJldHVybiBbLi4ucHJlbG9hZGVkLCAuLi5zeW5jXS5qb2luKCcnKTtcbn1cblxuZnVuY3Rpb24gZ2V0UHJlbG9hZEhpbnRMaW5rcyhjdHgpIHtcbiAgY29uc3QgY2h1bmtzID0gWy4uLmN0eC5wcmVsb2FkQ2h1bmtzLCAuLi5jdHguc3luY0NodW5rc107XG4gIGNvbnN0IGhpbnRzID0gZ2V0VXJscyhjdHgsIGNodW5rcykubWFwKCh7dXJsLCBjcm9zc09yaWdpbkF0dHJpYnV0ZX0pID0+IHtcbiAgICByZXR1cm4gYDxsaW5rIHJlbD1cInByZWxvYWRcIiR7Y3Jvc3NPcmlnaW5BdHRyaWJ1dGV9IGhyZWY9XCIke3VybH1cIiBub25jZT1cIiR7Y3R4Lm5vbmNlfVwiIGFzPVwic2NyaXB0XCIgLz5gO1xuICB9KTtcbiAgcmV0dXJuIGhpbnRzLmpvaW4oJycpO1xufVxuXG5mdW5jdGlvbiBnZXRTZXJpYWxpemVkVW5pdmVyc2FsVmFsdWVzKGN0eCkge1xuICBjb25zdCBhcHAgPSBjdHhbYXBwU3ltYm9sXTtcbiAgcmV0dXJuIGh0bWxgPHNjcmlwdCB0eXBlPVwiYXBwbGljYXRpb24vanNvblwiIGlkPVwiX19GVVNJT05fVU5JVkVSU0FMX1ZBTFVFU19fXCI+XG4gICAgJHtKU09OLnN0cmluZ2lmeSh7Li4uYXBwLnVuaXZlcnNhbFZhbHVlcywgLi4uY3R4LnVuaXZlcnNhbFZhbHVlc30pfVxuICA8L3NjcmlwdD5gO1xufVxuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsU0FBUUEsWUFBWSxRQUFPLGtCQUFrQjtBQUM3QyxTQUFRQyxNQUFNLEVBQUVDLG9CQUFvQixFQUFFQyxJQUFJLFFBQU8saUJBQWlCO0FBQ2xFLFNBQVFDLG1DQUFtQyxRQUFPLFdBQVc7QUFDN0QsU0FBUUMsU0FBUyxRQUFPLHFCQUFxQjtBQUM3QyxTQUFRQyxLQUFLLFFBQU8saUJBQWlCO0FBT3JDLE1BQU1DLFVBQVUsR0FBR1AsWUFBWSxDQUFDO0VBQzlCUSxJQUFJLEVBQUU7SUFDSkMscUJBQXFCLEVBQUVMLG1DQUFtQyxDQUFDTTtFQUM3RCxDQUFDO0VBQ0RDLFFBQVEsRUFBR0gsSUFBSSxJQUF3QjtJQUNyQyxPQUFRSSxHQUFHLElBQUs7TUFDZDtNQUNBO01BQ0EsSUFBSUEsR0FBRyxDQUFDQyxJQUFJLENBQUNDLEtBQUssQ0FBQywwQ0FBMEMsQ0FBQyxFQUM1RCxPQUFPLEtBQUs7TUFFZCxJQUFJUixLQUFLLENBQUNNLEdBQUcsQ0FBQyxFQUFFO1FBQ2QsT0FBTyxJQUFJO01BQ2I7O01BRUE7TUFDQTtNQUNBO01BQ0EsSUFBSSxDQUFDQSxHQUFHLENBQUNHLE9BQU8sQ0FBQ0MsTUFBTSxFQUFFLE9BQU8sS0FBSztNQUNyQyxJQUFJLENBQUNKLEdBQUcsQ0FBQ0csT0FBTyxDQUFDQyxNQUFNLENB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