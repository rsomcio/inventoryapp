/** Copyright (c) 2018 Uber Technologies, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

import uuidv4 from 'uuid/v4';
import UAParser from 'ua-parser-js';
import getEnv from '../get-env';
const envVars = getEnv();
export default function middleware(ctx, next) {
  // env vars
  ctx.rootDir = envVars.rootDir;
  ctx.env = envVars.env;
  ctx.prefix = envVars.prefix;
  ctx.assetPath = envVars.assetPath;
  ctx.cdnUrl = envVars.cdnUrl;

  // webpack-related things
  ctx.preloadChunks = [];
  ctx.webpackPublicPath = ctx.webpackPublicPath || envVars.cdnUrl || envVars.assetPath;

  // these are set by fusion-cli, however since fusion-cli plugins are not added when
  // running simulation tests, it is good to default them here
  ctx.syncChunks = ctx.syncChunks || [];
  ctx.chunkUrlMap = ctx.chunkUrlMap || new Map();

  // fusion-specific things
  ctx.nonce = uuidv4();
  ctx.useragent = new UAParser(ctx.headers['user-agent']).getResult();
  ctx.element = null;
  ctx.rendered = null;
  ctx.postPrepareEffects = [];
  ctx.universalValues = {};
  return next();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ1dWlkdjQiLCJVQVBhcnNlciIsImdldEVudiIsImVudlZhcnMiLCJtaWRkbGV3YXJlIiwiY3R4IiwibmV4dCIsInJvb3REaXIiLCJlbnYiLCJwcmVmaXgiLCJhc3NldFBhdGgiLCJjZG5VcmwiLCJwcmVsb2FkQ2h1bmtzIiwid2VicGFja1B1YmxpY1BhdGgiLCJzeW5jQ2h1bmtzIiwiY2h1bmtVcmxNYXAiLCJNYXAiLCJub25jZSIsInVzZXJhZ2VudCIsImhlYWRlcnMiLCJnZXRSZXN1bHQiLCJlbGVtZW50IiwicmVuZGVyZWQiLCJwb3N0UHJlcGFyZUVmZmVjdHMiLCJ1bml2ZXJzYWxWYWx1ZXMiXSwic291cmNlcyI6WyJzcmMvcGx1Z2lucy9zZXJ2ZXItY29udGV4dC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiogQ29weXJpZ2h0IChjKSAyMDE4IFViZXIgVGVjaG5vbG9naWVzLCBJbmMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICovXG5cbmltcG9ydCB1dWlkdjQgZnJvbSAndXVpZC92NCc7XG5pbXBvcnQgVUFQYXJzZXIgZnJvbSAndWEtcGFyc2VyLWpzJztcbmltcG9ydCBnZXRFbnYgZnJvbSAnLi4vZ2V0LWVudic7XG5cbmltcG9ydCB0eXBlIHtDb250ZXh0fSBmcm9tICcuLi90eXBlcyc7XG5cbmNvbnN0IGVudlZhcnMgPSBnZXRFbnYoKTtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gbWlkZGxld2FyZShjdHg6IENvbnRleHQsIG5leHQ6ICgpID0+IFByb21pc2U8dm9pZD4pIHtcbiAgLy8gZW52IHZhcnNcbiAgY3R4LnJvb3REaXIgPSBlbnZWYXJzLnJvb3REaXI7XG4gIGN0eC5lbnYgPSBlbnZWYXJzLmVudjtcbiAgY3R4LnByZWZpeCA9IGVudlZhcnMucHJlZml4O1xuICBjdHguYXNzZXRQYXRoID0gZW52VmFycy5hc3NldFBhdGg7XG4gIGN0eC5jZG5VcmwgPSBlbnZWYXJzLmNkblVybDtcblxuICAvLyB3ZWJwYWNrLXJlbGF0ZWQgdGhpbmdzXG4gIGN0eC5wcmVsb2FkQ2h1bmtzID0gW107XG4gIGN0eC53ZWJwYWNrUHVibGljUGF0aCA9XG4gICAgY3R4LndlYnBhY2tQdWJsaWNQYXRoIHx8IGVudlZhcnMuY2RuVXJsIHx8IGVudlZhcnMuYXNzZXRQYXRoO1xuXG4gIC8vIHRoZXNlIGFyZSBzZXQgYnkgZnVzaW9uLWNsaSwgaG93ZXZlciBzaW5jZSBmdXNpb24tY2xpIHBsdWdpbnMgYXJlIG5vdCBhZGRlZCB3aGVuXG4gIC8vIHJ1bm5pbmcgc2ltdWxhdGlvbiB0ZXN0cywgaXQgaXMgZ29vZCB0byBkZWZhdWx0IHRoZW0gaGVyZVxuICBjdHguc3luY0NodW5rcyA9IGN0eC5zeW5jQ2h1bmtzIHx8IFtdO1xuICBjdHguY2h1bmtVcmxNYXAgPSBjdHguY2h1bmtVcmxNYXAgfHwgbmV3IE1hcCgpO1xuXG4gIC8vIGZ1c2lvbi1zcGVjaWZpYyB0aGluZ3NcbiAgY3R4Lm5vbmNlID0gdXVpZHY0KCk7XG4gIGN0eC51c2VyYWdlbnQgPSBuZXcgVUFQYXJzZXIoY3R4LmhlYWRlcnNbJ3VzZXItYWdlbnQnXSkuZ2V0UmVzdWx0KCk7XG4gIGN0eC5lbGVtZW50ID0gbnVsbDtcbiAgY3R4LnJlbmRlcmVkID0gbnVsbDtcbiAgY3R4LnBvc3RQcmVwYXJlRWZmZWN0cyA9IFtdO1xuICBjdHgudW5pdmVyc2FsVmFsdWVzID0ge307XG5cbiAgcmV0dXJuIG5leHQoKTtcbn1cbiJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLE9BQU9BLE1BQU0sTUFBTSxTQUFTO0FBQzVCLE9BQU9DLFFBQVEsTUFBTSxjQUFjO0FBQ25DLE9BQU9DLE1BQU0sTUFBTSxZQUFZO0FBSS9CLE1BQU1DLE9BQU8sR0FBR0QsTUFBTSxFQUFFO0FBRXhCLGVBQWUsU0FBU0UsVUFBVSxDQUFDQyxHQUFZLEVBQUVDLElBQXlCLEVBQUU7RUFDMUU7RUFDQUQsR0FBRyxDQUFDRSxPQUFPLEdBQUdKLE9BQU8sQ0FBQ0ksT0FBTztFQUM3QkYsR0FBRyxDQUFDRyxHQUFHLEdBQUdMLE9BQU8sQ0FBQ0ssR0FBRztFQUNyQkgsR0FBRyxDQUFDSSxNQUFNLEdBQUdOLE9BQU8sQ0FBQ00sTUFBTTtFQUMzQkosR0FBRyxDQUFDSyxTQUFTLEdBQUdQLE9BQU8sQ0FBQ08sU0FBUztFQUNqQ0wsR0FBRyxDQUFDTSxNQUFNLEdBQUdSLE9BQU8sQ0FBQ1EsTUFBTTs7RUFFM0I7RUFDQU4sR0FBRyxDQUFDTyxhQUFhLEdBQUcsRUFBRTtFQUN0QlAsR0FBRyxDQUFDUSxpQkFBaUIsR0FDbkJSLEdBQUcsQ0FBQ1EsaUJBQWlCLElBQUlWLE9BQU8sQ0FBQ1EsTUFBTSxJQUFJUixPQUFPLENBQUNPLFNBQVM7O0VBRTlEO0VBQ0E7RUFDQUwsR0FBRyxDQUFDUyxVQUFVLEdBQUdULEdBQUcsQ0FBQ1MsVUFBVSxJQUFJLEVBQUU7RUFDckNULEdBQUcsQ0FBQ1UsV0FBVyxHQUFHVixHQUFHLENBQUNVLFdBQVcsSUFBSSxJQUFJQyxHQUFHLEVBQUU7O0VBRTlDO0VBQ0FYLEdBQUcsQ0FBQ1ksS0FBSyxHQUFHakIsTUFBTSxFQUFFO0VBQ3BCSyxHQUFHLENBQUNhLFNBQVMsR0FBRyxJQUFJakIsUUFBUSxDQUFDSSxHQUFHLENBQUNjLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDQyxTQUFTLEVBQUU7RUFDbkVmLEdBQUcsQ0FBQ2dCLE9BQU8sR0FBRyxJQUFJO0VBQ2xCaEIsR0FBRyxDQUFDaUIsUUFBUSxHQUFHLElBQUk7RUFDbkJqQixHQUFHLENBQUNrQixrQkFBa0IsR0FBRyxFQUFFO0VBQzNCbEIsR0FBRyxDQUFDbUIsZUFBZSxHQUFHLENBQUMsQ0FBQztFQUV4QixPQUFPbEIsSUFBSSxFQUFFO0FBQ2YifQ==