"use strict";

var _compose = require("../compose");
/** Copyright (c) 2018 Uber Technologies, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

test('composed middleware are executed correctly', () => {
  function A(ctx, next) {
    return next();
  }
  const middleware = (0, _compose.compose)([A]);
  const next = () => Promise.resolve();
  // @ts-expect-error
  expect(() => middleware({}, next)).not.toThrow();
  expect(() => middleware(void 0, next)).not.toThrow();
  // @ts-expect-error
  expect(() => middleware()).not.toThrow();
});
test('downstream and upstream run in same order as koa', done => {
  expect.assertions(6);
  function a(ctx, next) {
    expect(++ctx.number).toBe(1);
    return next().then(() => {
      expect(++ctx.number).toBe(6);
    });
  }
  function b(ctx, next) {
    expect(++ctx.number).toBe(2);
    return next().then(() => {
      expect(++ctx.number).toBe(5);
    });
  }
  function c(ctx, next) {
    expect(++ctx.number).toBe(3);
    return next().then(() => {
      expect(++ctx.number).toBe(4);
    });
  }
  const middleware = (0, _compose.compose)([a, b, c]);
  const ctx = {
    number: 0
  };
  const next = () => Promise.resolve();
  // @ts-expect-error
  middleware(ctx, next).then(done);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ0ZXN0IiwiQSIsImN0eCIsIm5leHQiLCJtaWRkbGV3YXJlIiwiY29tcG9zZSIsIlByb21pc2UiLCJyZXNvbHZlIiwiZXhwZWN0Iiwibm90IiwidG9UaHJvdyIsImRvbmUiLCJhc3NlcnRpb25zIiwiYSIsIm51bWJlciIsInRvQmUiLCJ0aGVuIiwiYiIsImMiXSwic291cmNlcyI6WyJzcmMvX190ZXN0c19fL2NvbXBvc2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqIENvcHlyaWdodCAoYykgMjAxOCBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqL1xuXG5pbXBvcnQge2NvbXBvc2V9IGZyb20gJy4uL2NvbXBvc2UnO1xuXG50ZXN0KCdjb21wb3NlZCBtaWRkbGV3YXJlIGFyZSBleGVjdXRlZCBjb3JyZWN0bHknLCAoKSA9PiB7XG4gIGZ1bmN0aW9uIEEoY3R4LCBuZXh0KSB7XG4gICAgcmV0dXJuIG5leHQoKTtcbiAgfVxuICBjb25zdCBtaWRkbGV3YXJlID0gY29tcG9zZShbQV0pO1xuICBjb25zdCBuZXh0ID0gKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIC8vIEB0cy1leHBlY3QtZXJyb3JcbiAgZXhwZWN0KCgpID0+IG1pZGRsZXdhcmUoe30sIG5leHQpKS5ub3QudG9UaHJvdygpO1xuICBleHBlY3QoKCkgPT4gbWlkZGxld2FyZSh2b2lkIDAsIG5leHQpKS5ub3QudG9UaHJvdygpO1xuICAvLyBAdHMtZXhwZWN0LWVycm9yXG4gIGV4cGVjdCgoKSA9PiBtaWRkbGV3YXJlKCkpLm5vdC50b1Rocm93KCk7XG59KTtcblxudGVzdCgnZG93bnN0cmVhbSBhbmQgdXBzdHJlYW0gcnVuIGluIHNhbWUgb3JkZXIgYXMga29hJywgKGRvbmUpID0+IHtcbiAgZXhwZWN0LmFzc2VydGlvbnMoNik7XG4gIGZ1bmN0aW9uIGEoY3R4LCBuZXh0KSB7XG4gICAgZXhwZWN0KCsrY3R4Lm51bWJlcikudG9CZSgxKTtcbiAgICByZXR1cm4gbmV4dCgpLnRoZW4oKCkgPT4ge1xuICAgICAgZXhwZWN0KCsrY3R4Lm51bWJlcikudG9CZSg2KTtcbiAgICB9KTtcbiAgfVxuICBmdW5jdGlvbiBiKGN0eCwgbmV4dCkge1xuICAgIGV4cGVjdCgrK2N0eC5udW1iZXIpLnRvQmUoMik7XG4gICAgcmV0dXJuIG5leHQoKS50aGVuKCgpID0+IHtcbiAgICAgIGV4cGVjdCgrK2N0eC5udW1iZXIpLnRvQmUoNSk7XG4gICAgfSk7XG4gIH1cbiAgZnVuY3Rpb24gYyhjdHgsIG5leHQpIHtcbiAgICBleHBlY3QoKytjdHgubnVtYmVyKS50b0JlKDMpO1xuICAgIHJldHVybiBuZXh0KCkudGhlbigoKSA9PiB7XG4gICAgICBleHBlY3QoKytjdHgubnVtYmVyKS50b0JlKDQpO1xuICAgIH0pO1xuICB9XG4gIGNvbnN0IG1pZGRsZXdhcmUgPSBjb21wb3NlKFthLCBiLCBjXSk7XG4gIGNvbnN0IGN0eCA9IHtudW1iZXI6IDB9O1xuICBjb25zdCBuZXh0ID0gKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gIC8vIEB0cy1leHBlY3QtZXJyb3JcbiAgbWlkZGxld2FyZShjdHgsIG5leHQpLnRoZW4oZG9uZSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7QUFPQTtBQVBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFJQUEsSUFBSSxDQUFDLDRDQUE0QyxFQUFFLE1BQU07RUFDdkQsU0FBU0MsQ0FBQyxDQUFDQyxHQUFHLEVBQUVDLElBQUksRUFBRTtJQUNwQixPQUFPQSxJQUFJLEVBQUU7RUFDZjtFQUNBLE1BQU1DLFVBQVUsR0FBRyxJQUFBQyxnQkFBTyxFQUFDLENBQUNKLENBQUMsQ0FBQyxDQUFDO0VBQy9CLE1BQU1FLElBQUksR0FBRyxNQUFNRyxPQUFPLENBQUNDLE9BQU8sRUFBRTtFQUNwQztFQUNBQyxNQUFNLENBQUMsTUFBTUosVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFFRCxJQUFJLENBQUMsQ0FBQyxDQUFDTSxHQUFHLENBQUNDLE9BQU8sRUFBRTtFQUNoREYsTUFBTSxDQUFDLE1BQU1KLFVBQVUsQ0FBQyxLQUFLLENBQUMsRUFBRUQsSUFBSSxDQUFDLENBQUMsQ0FBQ00sR0FBRyxDQUFDQyxPQUFPLEVBQUU7RUFDcEQ7RUFDQUYsTUFBTSxDQUFDLE1BQU1KLFVBQVUsRUFBRSxDQUFDLENBQUNLLEdBQUcsQ0FBQ0MsT0FBTyxFQUFFO0FBQzFDLENBQUMsQ0FBQztBQUVGVixJQUFJLENBQUMsa0RBQWtELEVBQUdXLElBQUksSUFBSztFQUNqRUgsTUFBTSxDQUFDSSxVQUFVLENBQUMsQ0FBQyxDQUFDO0VBQ3BCLFNBQVNDLENBQUMsQ0FBQ1gsR0FBRyxFQUFFQyxJQUFJLEVBQUU7SUFDcEJLLE1BQU0sQ0FBQyxFQUFFTixHQUFHLENBQUNZLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQzVCLE9BQU9aLElBQUksRUFBRSxDQUFDYSxJQUFJLENBQUMsTUFBTTtNQUN2QlIsTUFBTSxDQUFDLEVBQUVOLEdBQUcsQ0FBQ1ksTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDOUIsQ0FBQyxDQUFDO0VBQ0o7RUFDQSxTQUFTRSxDQUFDLENBQUNmLEdBQUcsRUFBRUMsSUFBSSxFQUFFO0lBQ3BCSyxNQUFNLENBQUMsRUFBRU4sR0FBRyxDQUFDWSxNQUFNLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUM1QixPQUFPWixJQUFJLEVBQUUsQ0FBQ2EsSUFBSSxDQUFDLE1BQU07TUFDdkJSLE1BQU0sQ0FBQyxFQUFFTixHQUFHLENBQUNZLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQzlCLENBQUMsQ0FBQztFQUNKO0VBQ0EsU0FBU0csQ0FBQyxDQUFDaEIsR0FBRyxFQUFFQyxJQUFJLEVBQUU7SUFDcEJLLE1BQU0sQ0FBQyxFQUFFTixHQUFHLENBQUNZLE1BQU0sQ0FBQyxDQUFDQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQzVCLE9BQU9aLElBQUksRUFBRSxDQUFDYSxJQUFJLENBQUMsTUFBTTtNQUN2QlIsTUFBTSxDQUFDLEVBQUVOLEdBQUcsQ0FBQ1ksTUFBTSxDQUFDLENBQUNDLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDOUIsQ0FBQyxDQUFDO0VBQ0o7RUFDQSxNQUFNWCxVQUFVLEdBQUcsSUFBQUMsZ0JBQU8sRUFBQyxDQUFDUSxDQUFDLEVBQUVJLENBQUMsRUFBRUMsQ0FBQyxDQUFDLENBQUM7RUFDckMsTUFBTWhCLEdBQUcsR0FBRztJQUFDWSxNQUFNLEVBQUU7RUFBQyxDQUFDO0VBQ3ZCLE1BQU1YLElBQUksR0FBRyxNQUFNRyxPQUFPLENBQUNDLE9BQU8sRUFBRTtFQUNwQztFQUNBSCxVQUFVLENBQUNGLEdBQUcsRUFBRUMsSUFBSSxDQUFDLENBQUNhLElBQUksQ0FBQ0wsSUFBSSxDQUFDO0FBQ2xDLENBQUMsQ0FBQyJ9