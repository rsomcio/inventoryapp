import { run } from './test-helper';
import App, { Context, withEndpoint } from '../index';
import { declarePlugin } from '../create-plugin';
test('withEndpoint works', async () => {
  const element = 'hi';
  const renderFn = el => {
    return el;
  };
  const app = new App(element, renderFn);
  const EndpointPlugin = declarePlugin(
  // eslint-disable-next-line require-yield
  function* MyPlugin() {
    withEndpoint('/_foobar', (ctx, next) => {
      ctx.body = 'foobar';
      return next();
    });
  });
  app.register(EndpointPlugin);
  const ctx = await run(app, {
    method: 'GET',
    path: '/_foobar',
    headers: {
      accept: 'text/html'
    }
  });
  expect(ctx.body).toBe('foobar');
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJydW4iLCJBcHAiLCJDb250ZXh0Iiwid2l0aEVuZHBvaW50IiwiZGVjbGFyZVBsdWdpbiIsInRlc3QiLCJlbGVtZW50IiwicmVuZGVyRm4iLCJlbCIsImFwcCIsIkVuZHBvaW50UGx1Z2luIiwiTXlQbHVnaW4iLCJjdHgiLCJuZXh0IiwiYm9keSIsInJlZ2lzdGVyIiwibWV0aG9kIiwicGF0aCIsImhlYWRlcnMiLCJhY2NlcHQiLCJleHBlY3QiLCJ0b0JlIl0sInNvdXJjZXMiOlsic3JjL19fdGVzdHNfXy9lbmRwb2ludHMubm9kZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge3J1bn0gZnJvbSAnLi90ZXN0LWhlbHBlcic7XG5pbXBvcnQgQXBwLCB7Q29udGV4dCwgd2l0aEVuZHBvaW50fSBmcm9tICcuLi9pbmRleCc7XG5pbXBvcnQge2RlY2xhcmVQbHVnaW59IGZyb20gJy4uL2NyZWF0ZS1wbHVnaW4nO1xuXG50ZXN0KCd3aXRoRW5kcG9pbnQgd29ya3MnLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGVsZW1lbnQgPSAnaGknO1xuICBjb25zdCByZW5kZXJGbiA9IChlbCkgPT4ge1xuICAgIHJldHVybiBlbDtcbiAgfTtcbiAgY29uc3QgYXBwID0gbmV3IEFwcChlbGVtZW50LCByZW5kZXJGbik7XG5cbiAgY29uc3QgRW5kcG9pbnRQbHVnaW4gPSBkZWNsYXJlUGx1Z2luKFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZXF1aXJlLXlpZWxkXG4gICAgZnVuY3Rpb24qIE15UGx1Z2luKCkge1xuICAgICAgd2l0aEVuZHBvaW50KCcvX2Zvb2JhcicsIChjdHgsIG5leHQpID0+IHtcbiAgICAgICAgY3R4LmJvZHkgPSAnZm9vYmFyJztcbiAgICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgKTtcblxuICBhcHAucmVnaXN0ZXIoRW5kcG9pbnRQbHVnaW4pO1xuXG4gIGNvbnN0IGN0eCA9IGF3YWl0IHJ1bihhcHAsIHtcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIHBhdGg6ICcvX2Zvb2JhcicsXG4gICAgaGVhZGVyczoge1xuICAgICAgYWNjZXB0OiAndGV4dC9odG1sJyxcbiAgICB9LFxuICB9IGFzIENvbnRleHQpO1xuICBleHBlY3QoY3R4LmJvZHkpLnRvQmUoJ2Zvb2JhcicpO1xufSk7XG4iXSwibWFwcGluZ3MiOiJBQUFBLFNBQVFBLEdBQUcsUUFBTyxlQUFlO0FBQ2pDLE9BQU9DLEdBQUcsSUFBR0MsT0FBTyxFQUFFQyxZQUFZLFFBQU8sVUFBVTtBQUNuRCxTQUFRQyxhQUFhLFFBQU8sa0JBQWtCO0FBRTlDQyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsWUFBWTtFQUNyQyxNQUFNQyxPQUFPLEdBQUcsSUFBSTtFQUNwQixNQUFNQyxRQUFRLEdBQUlDLEVBQUUsSUFBSztJQUN2QixPQUFPQSxFQUFFO0VBQ1gsQ0FBQztFQUNELE1BQU1DLEdBQUcsR0FBRyxJQUFJUixHQUFHLENBQUNLLE9BQU8sRUFBRUMsUUFBUSxDQUFDO0VBRXRDLE1BQU1HLGNBQWMsR0FBR04sYUFBYTtFQUNsQztFQUNBLFVBQVVPLFFBQVEsR0FBRztJQUNuQlIsWUFBWSxDQUFDLFVBQVUsRUFBRSxDQUFDUyxHQUFHLEVBQUVDLElBQUksS0FBSztNQUN0Q0QsR0FBRyxDQUFDRSxJQUFJLEdBQUcsUUFBUTtNQUNuQixPQUFPRCxJQUFJLEVBQUU7SUFDZixDQUFDLENBQUM7RUFDSixDQUFDLENBQ0Y7RUFFREosR0FBRyxDQUFDTSxRQUFRLENBQUNMLGNBQWMsQ0FBQztFQUU1QixNQUFNRSxHQUFHLEdBQUcsTUFBTVosR0FBRyxDQUFDUyxHQUFHLEVBQUU7SUFDekJPLE1BQU0sRUFBRSxLQUFLO0lBQ2JDLElBQUksRUFBRSxVQUFVO0lBQ2hCQyxPQUFPLEVBQUU7TUFDUEMsTUFBTSxFQUFFO0lBQ1Y7RUFDRixDQUFDLENBQVk7RUFDYkMsTUFBTSxDQUFDUixHQUFHLENBQUNFLElBQUksQ0FBQyxDQUFDTyxJQUFJLENBQUMsUUFBUSxDQUFDO0FBQ2pDLENBQUMsQ0FBQyJ9